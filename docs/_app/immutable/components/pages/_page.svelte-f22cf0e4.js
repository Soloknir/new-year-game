var Nt=Object.defineProperty;var Wt=(a,t,e)=>t in a?Nt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>(Wt(a,typeof t!="symbol"?t+"":t,e),e);import{S as it,i as at,s as nt,k as T,l as I,m as F,h as E,n as L,b as G,B as q,I as Yt,J as vt,a as j,c as tt,K as ct,L as Ct,D as R,M as Bt,o as mt,N as Vt,O as pt,q as N,r as W,u as Mt,p as St,f as Q,g as $t,t as st,d as Ft,v as _t,w as gt,x as Gt,y as ut,z as ft,P as Zt}from"../../chunks/index-b385805f.js";function Lt(a,t,e){const s=a.slice();return s[12]=t[e].flip,s[13]=t[e].name,s[14]=t[e].alt,s[16]=e,s}function Et(a){let t,e,s,i,o,r,l,h,m,g,p;function _(){return a[2](a[16])}return{c(){t=T("div"),e=T("img"),o=j(),r=T("img"),h=j(),this.h()},l(b){t=I(b,"DIV",{class:!0,"data-name":!0});var x=F(t);e=I(x,"IMG",{class:!0,src:!0,alt:!0}),o=tt(x),r=I(x,"IMG",{class:!0,src:!0,alt:!0}),h=tt(x),x.forEach(E),this.h()},h(){L(e,"class","front-face svelte-pdp5dg"),ct(e.src,s="/new-year-game/assets/flip/"+a[13]+".svg")||L(e,"src",s),L(e,"alt",i=a[14]),L(r,"class","back-face svelte-pdp5dg"),ct(r.src,l="/new-year-game/assets/flip/js-badge.svg")||L(r,"src",l),L(r,"alt","Memory Card"),L(t,"class","memory-card svelte-pdp5dg"),L(t,"data-name",m=a[13]),Ct(t,"flip",a[12])},m(b,x){G(b,t,x),R(t,e),R(t,o),R(t,r),R(t,h),g||(p=Bt(t,"click",_),g=!0)},p(b,x){a=b,x&1&&!ct(e.src,s="/new-year-game/assets/flip/"+a[13]+".svg")&&L(e,"src",s),x&1&&i!==(i=a[14])&&L(e,"alt",i),x&1&&m!==(m=a[13])&&L(t,"data-name",m),x&1&&Ct(t,"flip",a[12])},d(b){b&&E(t),g=!1,p()}}}function Xt(a){let t,e=a[0],s=[];for(let i=0;i<e.length;i+=1)s[i]=Et(Lt(a,e,i));return{c(){t=T("div");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){t=I(i,"DIV",{class:!0});var o=F(t);for(let r=0;r<s.length;r+=1)s[r].l(o);o.forEach(E),this.h()},h(){L(t,"class","memory-game svelte-pdp5dg")},m(i,o){G(i,t,o);for(let r=0;r<s.length;r+=1)s[r].m(t,null)},p(i,[o]){if(o&3){e=i[0];let r;for(r=0;r<e.length;r+=1){const l=Lt(i,e,r);s[r]?s[r].p(l,o):(s[r]=Et(l),s[r].c(),s[r].m(t,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=e.length}},i:q,o:q,d(i){i&&E(t),Yt(s,i)}}}function Qt(a,t,e){const s=vt();let i=!1,o=!1,r=null,l=null,h=[{name:"react",alt:"React",flip:!1,order:0},{name:"react",alt:"React",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0}];function m(A){if(!o&&r!==A){if(e(0,h[A].flip=!0,h),!i){i=!0,r=A;return}l=A,o=!0,g()}}function g(){r!==null&&l!==null&&(h[r].name===h[l].name?p():_(h[r],h[l]))}function p(){b(),h.some(A=>!A.flip)||s("done")}function _(A,V){setTimeout(()=>{A.flip=!1,V.flip=!1,e(0,h=[...h]),b()},1500)}function b(){i=!1,o=!1,r=null,l=null}return function(){e(0,h=h.map(V=>(V.order=Math.ceil(Math.random()*12),V)).sort((V,Y)=>V.order>Y.order?1:-1))}(),[h,m,A=>m(A)]}class jt extends it{constructor(t){super(),at(this,t,Qt,Xt,nt,{})}}let ht;const te=new Uint8Array(16);function ee(){if(!ht&&(ht=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ht))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ht(te)}const D=[];for(let a=0;a<256;++a)D.push((a+256).toString(16).slice(1));function se(a,t=0){return(D[a[t+0]]+D[a[t+1]]+D[a[t+2]]+D[a[t+3]]+"-"+D[a[t+4]]+D[a[t+5]]+"-"+D[a[t+6]]+D[a[t+7]]+"-"+D[a[t+8]]+D[a[t+9]]+"-"+D[a[t+10]]+D[a[t+11]]+D[a[t+12]]+D[a[t+13]]+D[a[t+14]]+D[a[t+15]]).toLowerCase()}const ie=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),bt={randomUUID:ie};function yt(a,t,e){if(bt.randomUUID&&!t&&!a)return bt.randomUUID();a=a||{};const s=a.random||(a.rng||ee)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){e=e||0;for(let i=0;i<16;++i)t[e+i]=s[i];return t}return se(s)}class Kt{constructor(t,e){n(this,"type","");n(this,"id");n(this,"once");n(this,"callback");n(this,"check",t=>!1);this.id=yt(),this.once=t,this.callback=e}}class ae extends Kt{constructor(e,s,i){super(s,i);n(this,"type","collision");n(this,"object");n(this,"check",e=>zt(e,this.object));this.object=e}}class ne extends Kt{constructor(e,s,i,o,r){super(o,r);n(this,"type","edge");n(this,"sign");n(this,"axis");n(this,"value");n(this,"check",e=>this.axis==="x"?this.sign==="gather"?e.vCoordinates.x+e.getLeft()>this.value:e.vCoordinates.x+e.getRight()<this.value:this.sign==="gather"?e.vCoordinates.y+e.getBottom()>this.value:e.vCoordinates.y+e.getTop()<this.value);this.sign=e,this.axis=s,this.value=i}}class rt{constructor(t,e){n(this,"id");n(this,"vCoordinates");n(this,"vVelocity");n(this,"eventListeners",[]);n(this,"draw",(t,e,s)=>{});n(this,"update",(t,e)=>this.checkEventListeners());n(this,"checkEventListeners",()=>{});n(this,"addEventListener",t=>this.eventListeners.push(t));n(this,"removeEventListener",t=>{const e=this.eventListeners.findIndex(({id:s})=>s===t);e>-1&&this.eventListeners.splice(e,1)});this.id=yt(),this.vCoordinates=t,this.vVelocity=e}}const dt=a=>"width"in a&&"height"in a,kt=a=>"radius"in a,re=a=>"isColliding"in a,oe=a=>"mass"in a,he=(a,t)=>!(t.vCoordinates.x>a.width+a.vCoordinates.x||a.vCoordinates.x>t.width+t.vCoordinates.x||t.vCoordinates.y>a.height+a.vCoordinates.y||a.vCoordinates.y>t.height+t.vCoordinates.y),At=(a,t)=>{const e=t.vCoordinates.getCopy(),{width:s,height:i}=a;return e.x=t.vCoordinates.x<a.vCoordinates.x?a.vCoordinates.x:t.vCoordinates.x>a.vCoordinates.x+s?a.vCoordinates.x+s:e.x,e.y=t.vCoordinates.y<a.vCoordinates.y?a.vCoordinates.y:t.vCoordinates.y>a.vCoordinates.y+i?a.vCoordinates.y+i:e.y,t.vCoordinates.getDistance(e)<=t.radius},le=(a,t)=>a.vCoordinates.getDistance(t.vCoordinates)<=a.radius+t.radius,zt=(a,t)=>{if(kt(a)){if(kt(t))return le(a,t);if(dt(t))return At(t,a)}return dt(a)?dt(t)?he(a,t):At(a,t):!1};class C{constructor(t=0,e=0){n(this,"x");n(this,"y");n(this,"getCopy",()=>new C(this.x,this.y));n(this,"getCoordsObject",()=>({x:this.x,y:this.y}));n(this,"setByCoordsObject",({x:t,y:e})=>(this.x=t,this.y=e,this));n(this,"ceil",()=>(this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this));n(this,"divByNumber",t=>new C(this.x/t,this.y/t));n(this,"getDifference",({x:t,y:e})=>new C(this.x-t,this.y-e));n(this,"getDistance",({x:t,y:e})=>{const s=this.x-t,i=this.y-e;return Math.sqrt(s*s+i*i)});this.x=t,this.y=e}getViewCoordinates(t){return new C(this.x,t-this.y)}}class wt extends rt{constructor(e,s,i){super(e,new C);n(this,"width");n(this,"height");n(this,"textures");n(this,"draw",(e,s,i)=>{const o=this.vCoordinates.getViewCoordinates(s);let r=this.height,l=0;for(;r>0;){let h=this.width,m=0;for(;h>0;)e.drawImage(l===0?this.textures.head:this.textures.body,0,0,Math.min(128,h),Math.min(128,r),128*m+o.x-i.x,128*l+o.y-this.height+i.y,Math.min(128,h),Math.min(128,r)),h-=128,m++;r-=128,l++}});n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width);this.width=s.width,this.height=s.height,this.textures=i}}class Ut extends wt{constructor(e,s,i,o){super(e,i,o);n(this,"vSpawn");n(this,"lastDistance");n(this,"behavior");n(this,"update",e=>{this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e;const s=this.behavior.vTarget.getDistance(this.vCoordinates);this.lastDistance<s?this.getMoveEndStrategy():this.lastDistance=s});n(this,"getVelocity",()=>{const e=this.behavior.vTarget.getDifference(this.vCoordinates);return e.x===0||e.y===0?e.x!==0?new C(e.x/this.behavior.duration,0):e.y!==0?new C(0,e.y/this.behavior.duration):new C:e.divByNumber(this.behavior.duration)});n(this,"getMoveEndStrategy",()=>{switch(this.behavior.repeat){case"fromStart":{this.vCoordinates=this.vSpawn.getCopy(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}case"fromEnd":{const e=this.vSpawn.getCopy();this.vSpawn=this.behavior.vTarget.getCopy(),this.behavior.vTarget=e,this.vCoordinates=this.vSpawn.getCopy(),this.vVelocity=this.getVelocity(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}default:this.vVelocity=new C}});if(this.vSpawn=e.getCopy(),this.behavior=s,this.lastDistance=s.vTarget.getDistance(this.vSpawn),this.vVelocity=this.getVelocity(),this.behavior.shift){const r=this.behavior.vTarget.getDifference(this.vCoordinates);this.vCoordinates.x+=this.behavior.shift*r.x,this.vCoordinates.x+=this.behavior.shift*r.y}}}class ce{constructor(t,e){n(this,"context");n(this,"vViewCoordinates",new C);n(this,"viewPortWidth");n(this,"viewPortHeight");n(this,"gameObjects",[]);n(this,"overlay",null);n(this,"backgroundImage",null);n(this,"time",0);n(this,"secondsPassed",0);n(this,"oldTimeStamp",0);n(this,"start",()=>window.requestAnimationFrame(this.gameLoop));n(this,"gameLoop",t=>{this.overlay?this.overlay.draw(this.context):(this.secondsPassed=(t-this.oldTimeStamp)/1e3,this.time+=this.secondsPassed,this.oldTimeStamp=t,this.gameObjects.forEach(e=>e.update(Math.min(this.secondsPassed,.1),this.vViewCoordinates)),this.detectPlatformCollision(),this.backgroundImage&&this.context.drawImage(this.backgroundImage,0,0,this.viewPortWidth,this.viewPortHeight),this.gameObjects.forEach(e=>e.draw(this.context,this.viewPortHeight,this.vViewCoordinates)),this.drawFps(Math.round(1/this.secondsPassed))),window.requestAnimationFrame(this.gameLoop)});n(this,"drawFps",t=>{this.context.fillStyle="#fff",this.context.font="20px Arial",this.context.textAlign="right",this.context.textBaseline="bottom",this.context.fillText(`fps: ${t}`,this.viewPortWidth-20,30)});n(this,"detectPlatformCollision",()=>{const t=this.gameObjects.filter(s=>s instanceof wt||s instanceof Ut),e=this.gameObjects.filter(s=>re(s)&&oe(s));t.forEach(s=>{e.forEach(i=>{zt(s,i)&&(i.vCoordinates.y+i.getBottom()>s.vCoordinates.y+s.getBottom()&&i.vCoordinates.y+i.getTop()>s.vCoordinates.y+s.getTop()&&i.vCoordinates.x+i.getRight()>s.vCoordinates.x+s.getLeft()&&i.vCoordinates.x+i.getLeft()<s.vCoordinates.x+s.getRight()&&(i.vCoordinates.y=s.vCoordinates.y+s.getTop()-i.getBottom(),i.vVelocity.x=i.vVelocity.x*(1-i.friction),i.vVelocity.y=1,i.platform=s),i.vCoordinates.y+i.getTop()<s.vCoordinates.y+s.getTop()&&i.vCoordinates.y+i.getBottom()<s.vCoordinates.y+s.getBottom()&&i.vCoordinates.x+i.getRight()>s.vCoordinates.x+s.getLeft()&&i.vCoordinates.x+i.getLeft()<s.vCoordinates.x+s.getRight()&&(i.vCoordinates.y=s.vCoordinates.y-i.getTop(),i.vVelocity.y=-1),i.vCoordinates.x+i.getLeft()<s.vCoordinates.x+s.getLeft()&&i.vCoordinates.x+i.getRight()>s.vCoordinates.x+s.getLeft()&&i.vCoordinates.y+i.getTop()<s.vCoordinates.y+s.getTop()&&i.vCoordinates.y+i.getBottom()>=s.vCoordinates.y+s.getBottom()&&(i.vCoordinates.x=s.vCoordinates.x-i.getRight(),i.vVelocity.x=-1),i.vCoordinates.x+i.getLeft()<s.vCoordinates.x+s.getRight()&&i.vCoordinates.x+i.getRight()>s.vCoordinates.x+s.getRight()&&i.vCoordinates.y+i.getTop()<s.vCoordinates.y+s.getTop()&&i.vCoordinates.y+i.getBottom()>=s.vCoordinates.y+s.getBottom()&&(i.vCoordinates.x=s.vCoordinates.x+s.getRight(),i.vVelocity.x=1))})})});n(this,"spawnObject",t=>this.gameObjects.push(t));n(this,"despawnObject",t=>this.gameObjects=this.gameObjects.filter(({id:e})=>t.id!==e));n(this,"worldReset",()=>this.vViewCoordinates=new C);this.context=t,this.viewPortWidth=e.width,this.viewPortHeight=e.height}}const de=[{id:"santa",position:{x:1e3,y:300}}],ge=[{id:"base",type:"static",position:{x:0,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:500,y:-200},size:{width:300,height:400}},{id:"base",type:"static",position:{x:900,y:-200},size:{width:300,height:500}},{id:"base",type:"static",position:{x:900,y:400},size:{width:300,height:250}},{id:"base",type:"static",position:{x:1500,y:-200},size:{width:100,height:525}},{id:"base",type:"static",position:{x:2e3,y:-200},size:{width:100,height:425}},{id:"base",type:"static",position:{x:2300,y:-200},size:{width:250,height:550}},{id:"base",type:"dynamic",position:{x:2600,y:200},size:{width:100,height:20},behavior:{target:{x:3e3,y:200},duation:10,repeat:"fromEnd",duration:10}},{id:"base",type:"dynamic",position:{x:3100,y:300},size:{width:100,height:20},behavior:{target:{x:3500,y:300},duation:10,repeat:"fromEnd",duration:10,shift:1}},{id:"base",type:"static",position:{x:3800,y:100},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4200,y:200},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4600,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:5e3,y:-200},size:{width:200,height:400}}],Dt={characters:de,platforms:ge},ue=9.8;class fe extends rt{constructor(e,s){super(e,new C);n(this,"width");n(this,"height");n(this,"friction");n(this,"mass");n(this,"platform",null);n(this,"isColliding",!1);n(this,"sprite");n(this,"time",0);n(this,"column",0);n(this,"row",2);n(this,"horizontalMoveSpeed");n(this,"jumpImpulse");n(this,"isJumping",!1);n(this,"isMoveRight",!1);n(this,"isMoveLeft",!1);n(this,"draw",(e,s,i)=>{const o=this.vCoordinates.getViewCoordinates(s);this.isMoveRight?(this.column=Math.round(this.time*10%8),this.row=11):this.isMoveLeft?(this.column=Math.round(this.time*10%8),this.row=9):(this.row=2,this.column=0);const r=64,l=64;e.drawImage(this.sprite,this.column*r+r/4,this.row*l,r-r/4,l-2,o.x-i.x,o.y-this.height+i.y,this.width,this.height)});n(this,"update",(e,s)=>{this.checkEventListeners(),this.time+=e,this.vVelocity.y-=ue*this.mass*e,this.vVelocity.x=0,this.isMoveRight&&(this.vVelocity.x+=this.horizontalMoveSpeed),this.isMoveLeft&&(this.vVelocity.x-=this.horizontalMoveSpeed),this.platform&&(this.vVelocity.x+=this.platform.vVelocity.x),this.isJumping&&this.platform&&(this.platform=null,this.vVelocity.y=this.jumpImpulse),this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e,s.x=this.vCoordinates.x-250,s.y=this.vCoordinates.y-250});n(this,"checkEventListeners",()=>{this.eventListeners.forEach(e=>{e.check(this)&&(e.once&&this.removeEventListener(e.id),e.callback())})});n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width-16);n(this,"startJumping",()=>this.isJumping=!0);n(this,"stopJumping",()=>this.isJumping=!1);n(this,"startMoveRight",()=>this.isMoveRight=!0);n(this,"stopMoveRight",()=>this.isMoveRight=!1);n(this,"startMoveLeft",()=>this.isMoveLeft=!0);n(this,"stopMoveLeft",()=>this.isMoveLeft=!1);this.sprite=s,this.width=64,this.height=64,this.friction=.1,this.mass=100,this.horizontalMoveSpeed=500,this.jumpImpulse=500}}class ve extends rt{constructor(e,s,i){super(e,s);n(this,"width");n(this,"height");n(this,"isColliding",!1);n(this,"sprite");n(this,"draw",(e,s,i)=>{const o=this.vCoordinates.getViewCoordinates(s);this.isColliding&&(e.fillStyle="grey",e.fillRect(o.x-i.x,o.y-this.height,this.getRight(),this.height));const r=64,l=64;e.drawImage(this.sprite,r,2*l,r-r/4,l-2,o.x-i.x,o.y-this.height+i.y,this.width,this.height)});n(this,"update",()=>null);n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width);this.sprite=i,this.width=64,this.height=64}}class me extends rt{constructor(e,s,i){super(e,new C);n(this,"width");n(this,"height");n(this,"textures");n(this,"draw",(e,s,i)=>{const o=this.vCoordinates.getViewCoordinates(s);let r=this.height,l=0;for(;r>0;){let h=this.width,m=0;for(;h>0;)e.drawImage(l===0?this.textures.head:this.textures.body,0,0,Math.min(128,h),Math.min(128,r),128*m+o.x-this.width/2,128*l+o.y-this.height+i.y,Math.min(128,h),Math.min(128,r)),h-=128,m++;r-=128,l++}});this.width=s.width,this.height=s.height,this.textures=i}}class pe extends rt{constructor(e,s,i){super(e,new C);n(this,"width");n(this,"height");n(this,"texture");n(this,"draw",e=>{e.drawImage(this.texture,0,0,1920,1080,0,0,this.width,this.height);const s=e.createLinearGradient(0,100,0,0);s.addColorStop(0,"rgba(0, 0, 0, 0.5)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=s,e.fillRect(0,this.height,this.width,-100),this.drawText(e),this.drawHelper(e)});n(this,"drawText",e=>{e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.textBaseline="bottom",e.fillText("\u041D\u0443\u0436\u043D\u043E \u043F\u043E\u043C\u043E\u0447\u044C \u0434\u0435\u0434\u0443 \u043C\u043E\u0440\u043E\u0437\u0443! \u041F\u043E\u0433\u043D\u0430\u043B\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u044F\u0442\u044C \u043A\u0432\u0435\u0441\u0442 :D",this.width/2,this.height-50)});n(this,"drawHelper",e=>{e.fillStyle="#ddd",e.font="15px Arial",e.textAlign="right",e.textBaseline="bottom",e.fillText("\u0414\u043B\u044F \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0435\u043D\u0438\u044F \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043F\u0440\u043E\u0431\u0435\u043B",this.width-10,this.height-10)});this.width=s.width,this.height=s.height,this.texture=i}}class ye{constructor(){n(this,"assets",{});n(this,"get",async(t,e="png")=>this.assets[t]||await this.loadAsset(t,e));n(this,"loadAssets",async t=>{const e=await Promise.all(t.map(s=>this.loadAsset(s)));t.map((s,i)=>this.assets[s]=e[i])});n(this,"loadAsset",(t,e="png")=>new Promise(s=>{const i=new Image;i.src=`/new-year-game/assets/${t}.${e}`,i.onload=()=>s(i)}))}}class H{constructor(t,e){n(this,"id");n(this,"keys");n(this,"callback");n(this,"handler");this.id=yt(),this.keys=t,this.callback=e}}class we{constructor(){n(this,"events",{});n(this,"handler",t=>e=>{var s;(s=this.events[t])==null||s.filter(({keys:i})=>i.includes(e.code)).map(({callback:i})=>i())});n(this,"addEventListener",(t,e)=>{this.events[t]=this.events[t]?[...this.events[t],e]:[e],e.handler=this.handler(t),window.addEventListener(t,e.handler)});n(this,"removeAllListeners",()=>{Object.keys(this.events).forEach(t=>{this.events[t].forEach(e=>window.removeEventListener(t,e.handler))}),this.events={}});n(this,"removeEventListener",t=>{Object.keys(this.events).forEach(e=>{const s=this.events[e].findIndex(({id:i})=>t.id===i);if(s>-1){this.events[e].splice(s,1),window.removeEventListener(e,t.handler);return}})})}}class xe{constructor(t,e){n(this,"context");n(this,"viewPortSize");n(this,"gameDriver");n(this,"controlsManager");n(this,"assetManager");n(this,"events",[]);n(this,"playerRespawn",new C(250,250));n(this,"currentSantaSpawn",0);n(this,"sound");n(this,"santaSpawnPositions",[new C(2400,350),new C(3800,200),new C(5100,200)]);n(this,"gameState",{isGameOver:!1,level:1});n(this,"gameStart",async()=>(this.gameDriver.backgroundImage=await this.assetManager.get("background","jpg"),await this.spawnPlayer(),this.addSantaMeetingEventListener(),this.addGameOverEventListener(),this.startListeningControls(),this.gameDriver.start(),this.gameState));n(this,"loadMap",()=>Promise.all([Promise.all(Dt.characters.map(({position:t})=>this.spawnSanta(t))),Promise.all(Dt.platforms.map(({id:t,type:e,position:s,behavior:i,size:o})=>e==="static"?this.spawnPlatform(t,s,o):this.spawnMovingPlatform(t,s,i,o))),this.spawnWater()]));n(this,"spawnPlayer",async()=>{let t=[];this.gameState.player&&(this.stopListeningControls(),t=[...this.gameState.player.eventListeners],this.gameDriver.despawnObject(this.gameState.player)),this.gameState.player=new fe(this.playerRespawn.getCopy(),await this.assetManager.get("characters/player")),this.gameState.player.eventListeners=t,this.gameDriver.spawnObject(this.gameState.player),this.startListeningControls()});n(this,"spawnSanta",async t=>(this.gameState.santa&&this.gameDriver.despawnObject(this.gameState.santa),this.gameState.santa=new ve(new C(t.x,t.y),new C,await this.assetManager.get("characters/santa")),this.gameDriver.spawnObject(this.gameState.santa),this.gameState.santa));n(this,"spawnWater",async()=>{const[t,e]=await Promise.all([this.assetManager.get("water/head"),this.assetManager.get("water/body")]),s=new me(new C(0,-400),{width:2*this.viewPortSize.width,height:400},{head:t,body:e});return this.gameDriver.spawnObject(s),s});n(this,"spawnOverlay",async()=>{this.gameState.overlay=this.gameDriver.overlay=new pe(new C(0,0),this.viewPortSize,await this.assetManager.get("dialog-overlay","jpg"))});n(this,"spawnPlatform",async(t,e,s)=>{const[i,o]=await Promise.all([this.assetManager.get(`platforms/${t}/head`),this.assetManager.get(`platforms/${t}/body`)]),r=new wt(e?new C().setByCoordsObject(e):new C,s||{width:0,height:0},{head:i,body:o});return this.gameDriver.spawnObject(r),r});n(this,"spawnMovingPlatform",async(t,e,s,i)=>{const[o,r]=await Promise.all([this.assetManager.get(`platforms/${t}/head`),this.assetManager.get(`platforms/${t}/body`)]),l=new Ut(e?new C().setByCoordsObject(e):new C,s?{...s,vTarget:new C().setByCoordsObject(s.target)}:{vTarget:new C,duration:1,repeat:"none"},i||{width:0,height:0},{head:o,body:r});return this.gameDriver.spawnObject(l),l});n(this,"addGameOverEventListener",()=>{this.gameState.player&&this.gameState.player.addEventListener(new ne("less","y",0,!1,this.spawnPlayer))});n(this,"addSantaMeetingEventListener",()=>{this.gameState.player&&this.gameState.santa&&this.gameState.player.addEventListener(new ae(this.gameState.santa,!0,this.spawnOverlay))});n(this,"startMiniGame",()=>{!this.sound&&this.playMusic(),this.gameState.santa&&this.gameState.player&&this.gameDriver.overlay&&(delete this.gameState.overlay,this.gameDriver.overlay=null,this.playerRespawn=this.gameState.santa.vCoordinates.getCopy(),this.currentSantaSpawn<3&&(this.gameState.santa.vCoordinates=this.santaSpawnPositions[this.currentSantaSpawn++].getCopy(),this.addSantaMeetingEventListener()),this.startMinigameCallback())});n(this,"startMinigameCallback",()=>{});n(this,"startListeningControls",()=>{this.gameState&&this.gameState.player&&(this.events=[{action:"keydown",event:new H(["ArrowUp","KeyW"],this.gameState.player.startJumping)},{action:"keydown",event:new H(["ArrowRight","KeyD"],this.gameState.player.startMoveRight)},{action:"keydown",event:new H(["ArrowLeft","KeyA"],this.gameState.player.startMoveLeft)},{action:"keydown",event:new H(["Space"],this.startMiniGame)},{action:"keyup",event:new H(["ArrowUp","KeyW"],this.gameState.player.stopJumping)},{action:"keyup",event:new H(["ArrowRight","KeyD"],this.gameState.player.stopMoveRight)},{action:"keyup",event:new H(["ArrowLeft","KeyA"],this.gameState.player.stopMoveLeft)}],this.events.map(({action:t,event:e})=>this.controlsManager.addEventListener(t,e)))});n(this,"stopListeningControls",()=>{this.events.forEach(({event:t})=>this.controlsManager.removeEventListener(t))});n(this,"playMusic",()=>{this.sound=document.createElement("audio"),this.sound.src="/new-year-game/assets/music/holiday_game_theme.mp3",this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.setAttribute("loop","true"),this.sound.volume=.05,this.sound.style.display="none",document.body.appendChild(this.sound),this.sound.play()});this.context=t,this.viewPortSize=e,this.gameDriver=new ce(t,e),this.controlsManager=new we,this.assetManager=new ye}}function Ce(a){let t;return{c(){t=T("canvas"),this.h()},l(e){t=I(e,"CANVAS",{width:!0,height:!0,id:!0}),F(t).forEach(E),this.h()},h(){L(t,"width","271"),L(t,"height","392"),L(t,"id","game")},m(e,s){G(e,t,s),a[1](t)},p:q,i:q,o:q,d(e){e&&E(t),a[1](null)}}}const S=32,Rt=1,B=4;function z(a){return a*Math.PI/180}function X(a,t,e){let s=Math.sin(e),i=Math.cos(e);return{x:a*i-t*s,y:a*s+t*i}}function Tt(a,t){return a=Math.ceil(a),t=Math.floor(t),Math.floor(Math.random()*(t-a+1))+a}function qt(a,t){const e=a.x-t.x,s=a.y-t.y;return Math.sqrt(e*e+s*s)}function It(a,t){return qt(a,t)<a.radius+t.radius}function Me(a,t,e){var xt;const s=vt();let i,o;const r=[],l={R:"red",G:"green",B:"blue",Y:"yellow"},h=Object.keys(l),m=Object.values(l),g=[];let p=[];_();function _(){for(let c=0;c<5;c++){const M=c%2===0?8:7,f=[];for(let w=0;w<M;w++)f.push(h[Tt(0,m.length-1)]);r.push(f)}}function b(c,M=!1){const f=g.filter(w=>w.active==M&&It(c,w));if(!!f.length)return f.map(w=>({distance:qt(c,w),bubble:w})).sort((w,P)=>w.distance-P.distance)[0].bubble}function x(c,M,f){const w=Math.floor(M/S),P=Math.floor(c/S),lt=w%2===0?0:.5*S,J=S/2;g.push({x:B+(S+Rt)*P+lt+J,y:B+(S+Rt-4)*w+J,radius:S/2,color:f,active:!!f})}function A(c){const M=[],f=[X(S,0,0),X(S,0,z(60)),X(S,0,z(120)),X(S,0,z(180)),X(S,0,z(240)),X(S,0,z(300))];for(let w=0;w<f.length;w++){const P=f[w],lt={x:c.x+P.x,y:c.y+P.y,radius:c.radius},J=b(lt,!0);J&&J!==c&&!M.includes(J)&&M.push(J)}return M}function V(c){const M=[c];g.forEach(w=>w.processed=!1),c.processed=!0;let f=A(c);for(let w=0;w<f.length;w++){let P=f[w];P.processed||(P.processed=!0,P.color===c.color&&(M.push(P),f=f.concat(A(P))))}M.length>=3&&M.forEach(w=>{w.active=!1})}function Y(){const c=g.filter(f=>f.active);c.forEach(f=>f.processed=!1);let M=c.filter(f=>f.y-S<=B);for(let f=0;f<M.length;f++){let w=M[f];w.processed||(w.processed=!0,M=M.concat(A(w)))}c.filter(f=>!f.processed).forEach(f=>{f.active=!1,p.push({x:f.x,y:f.y,color:f.color,radius:f.radius,active:!0})})}for(let c=0;c<10;c++)for(let M=0;M<(c%2===0?8:7);M++){const f=(xt=r[c])==null?void 0:xt[M];x(M*S,c*S,l[f])}let v,y,O=0;const et=z(-60),ot=z(60);let Z=0;function d(){y.x=v.x,y.y=v.y,y.dx=y.dy=0;const c=g.filter(f=>f.active).map(({color:f})=>f).reduce((f,w)=>f.includes(w)?f:[...f,w],[]),M=Tt(0,c.length-1);y.color=c[M],c.length===0&&s("done")}function u(c){c.color=y.color,c.active=!0,V(c),Y(),d()}let k;mt(()=>{if(!i)return;const c=i.getContext("2d");c&&(o=c),v={x:i.width/2,y:i.height-S*1.5},y={x:v.x,y:v.y,color:"red",radius:S/2,speed:8,dx:0,dy:0},window.addEventListener("keydown",K),window.addEventListener("keyup",Jt),k=requestAnimationFrame($)}),Vt(()=>cancelAnimationFrame(k));function $(){if(k=requestAnimationFrame($),o.clearRect(0,0,i.width,i.height),O=O+z(2)*Z,O<et?O=et:O>ot&&(O=ot),y.x+=y.dx,y.y+=y.dy,y.x-S/2<B?(y.x=B+S/2,y.dx*=-1):y.x+S/2>i.width-B&&(y.x=i.width-B-S/2,y.dx*=-1),y.y-S/2<B){const c=b(y);u(c)}for(let c=0;c<g.length;c++){const M=g[c];if(M.active&&It(y,M)){const f=b(y);f||(window.alert("Game Over"),window.location.reload()),f&&u(f)}}p.forEach(c=>{c.y+=8}),p=p.filter(c=>c.y<i.height-S/2),o.fillStyle="lightgrey",o.fillRect(0,0,i.width,B),o.fillRect(0,0,B,i.height),o.fillRect(i.width-B,0,B,i.height),g.concat(p).forEach(c=>{!c.active||(o.fillStyle=c.color,o.beginPath(),o.arc(c.x,c.y,c.radius,0,2*Math.PI),o.fill())}),o.save(),o.translate(v.x,v.y),o.rotate(O),o.translate(0,-S/2*4.5),o.strokeStyle="white",o.lineWidth=2,o.beginPath(),o.moveTo(0,0),o.lineTo(0,S*2),o.moveTo(0,0),o.lineTo(-10,S*.4),o.moveTo(0,0),o.lineTo(10,S*.4),o.stroke(),o.restore(),o.fillStyle=y.color,o.beginPath(),o.arc(y.x,y.y,y.radius,0,2*Math.PI),o.fill()}const K=c=>{switch(c.code){case"KeyA":case"ArrowLeft":Z=-1;break;case"KeyD":case"ArrowRight":Z=1;break;case"Space":y.dx===0&&y.dy===0&&(y.dx=Math.sin(O)*y.speed,y.dy=-Math.cos(O)*y.speed);break}},Jt=c=>{switch(c.code){case"KeyA":case"KeyD":case"ArrowLeft":case"ArrowRight":Z=0;break}};function Ht(c){pt[c?"unshift":"push"](()=>{i=c,e(0,i)})}return[i,Ht]}class Se extends it{constructor(t){super(),at(this,t,Me,Ce,nt,{})}}function _e(a){let t,e,s,i,o,r;return{c(){t=T("div"),e=T("canvas"),s=N(`\r
  Score: `),i=N(a[1]),o=N("/"),r=N(a[0]),this.h()},l(l){t=I(l,"DIV",{});var h=F(t);e=I(h,"CANVAS",{width:!0,height:!0,id:!0,class:!0}),F(e).forEach(E),s=W(h,`\r
  Score: `),i=W(h,a[1]),o=W(h,"/"),r=W(h,a[0]),h.forEach(E),this.h()},h(){L(e,"width","320"),L(e,"height","640"),L(e,"id","game"),L(e,"class","svelte-ny48w9")},m(l,h){G(l,t,h),R(t,e),a[3](e),R(t,s),R(t,i),R(t,o),R(t,r)},p(l,[h]){h&2&&Mt(i,l[1]),h&1&&Mt(r,l[0])},i:q,o:q,d(l){l&&E(t),a[3](null)}}}const U=32;function Le(a,t){return a=Math.ceil(a),t=Math.floor(t),Math.floor(Math.random()*(t-a+1))+a}function Ee(a){const t=a.length-1;return a.map((s,i)=>s.map((o,r)=>a[t-r][i]))}function be(a,t,e){const s=vt();let{target:i=10}=t,o=0;function r(){const d=["I","J","L","O","S","T","Z"];for(;d.length;){const u=Le(0,d.length-1),k=d.splice(u,1)[0];b.push(k)}}function l(){b.length===0&&r();const d=b.pop(),u=A[d],k=x[0].length/2-Math.ceil(u[0].length/2);return{name:d,matrix:u,row:d==="I"?-1:-2,col:k}}function h(d,u,k){for(let $=0;$<d.length;$++)for(let K=0;K<d[$].length;K++)if(d[$][K]&&(k+K<0||k+K>=x[0].length||u+$>=x.length||x[u+$][k+K]))return!1;return!0}function m(){for(let d=0;d<v.matrix.length;d++)for(let u=0;u<v.matrix[d].length;u++)if(v.matrix[d][u]){if(v.row+d<0)return g();x[v.row+d][v.col+u]=v.name}for(let d=x.length-1;d>=0;)if(x[d].every(u=>!!u)){for(let u=d;u>=0;u--)for(let k=0;k<x[u].length;k++)x[u][k]=x[u-1][k];e(1,o++,o),o>=i&&s("done")}else d--;v=l()}function g(){cancelAnimationFrame(y),O=!0,_.fillStyle="black",_.globalAlpha=.75,_.fillRect(0,p.height/2-30,p.width,60),_.globalAlpha=1,_.fillStyle="white",_.font="36px monospace",_.textAlign="center",_.textBaseline="middle",_.fillText("GAME OVER!",p.width/2,p.height/2)}let p,_;const b=[],x=[];for(let d=-2;d<20;d++){x[d]=[];for(let u=0;u<10;u++)x[d][u]=0}const A={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]]},V={I:"cyan",O:"yellow",T:"purple",S:"green",Z:"red",J:"blue",L:"orange"};let Y=0,v=l(),y=null,O=!1;mt(()=>{if(!p)return;const d=p.getContext("2d");d&&(_=d),y=requestAnimationFrame(et),window.addEventListener("keydown",ot)}),Vt(()=>cancelAnimationFrame(y));function et(){y=requestAnimationFrame(et),_.clearRect(0,0,p.width,p.height);for(let d=0;d<20;d++)for(let u=0;u<10;u++)if(x[d][u]){const k=x[d][u];_.fillStyle=V[k],_.fillRect(u*U,d*U,U-1,U-1)}if(v){++Y>35&&(v.row++,Y=0,h(v.matrix,v.row,v.col)||(v.row--,m())),_.fillStyle=V[v.name];for(let d=0;d<v.matrix.length;d++)for(let u=0;u<v.matrix[d].length;u++)v.matrix[d][u]&&_.fillRect((v.col+u)*U,(v.row+d)*U,U-1,U-1)}}const ot=d=>{if(!O)switch(d.code){case"KeyA":case"ArrowLeft":{const u=v.col-1;h(v.matrix,v.row,u)&&(v.col=u);break}case"KeyD":case"ArrowRight":{const u=v.col+1;h(v.matrix,v.row,u)&&(v.col=u);break}case"KeyW":case"ArrowUp":{const u=Ee(v.matrix);h(u,v.row,v.col)&&(v.matrix=u);break}case"KeyS":case"ArrowDown":{const u=v.row+1;if(!h(v.matrix,u,v.col)){v.row=u-1,m();return}v.row=u;break}}};function Z(d){pt[d?"unshift":"push"](()=>{p=d,e(2,p)})}return a.$$set=d=>{"target"in d&&e(0,i=d.target)},[i,o,p,Z]}class ke extends it{constructor(t){super(),at(this,t,be,_e,nt,{target:0})}}function Ot(a){let t,e;return{c(){t=T("h1"),e=N("\u0412\u044B \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438! \u0421 \u041D\u043E\u0432\u044B\u043C \u0413\u043E\u0434\u043E\u043C!")},l(s){t=I(s,"H1",{});var i=F(t);e=W(i,"\u0412\u044B \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438! \u0421 \u041D\u043E\u0432\u044B\u043C \u0413\u043E\u0434\u043E\u043C!"),i.forEach(E)},m(s,i){G(s,t,i),R(t,e)},d(s){s&&E(t)}}}function Pt(a){let t,e,s,i,o,r,l;var h=a[4][a[3]];function m(g){return{}}return h&&(t=_t(h,m()),t.$on("done",a[5])),{c(){t&&gt(t.$$.fragment),e=j(),s=T("button"),i=N("Skip minigame")},l(g){t&&Gt(t.$$.fragment,g),e=tt(g),s=I(g,"BUTTON",{});var p=F(s);i=W(p,"Skip minigame"),p.forEach(E)},m(g,p){t&&ut(t,g,p),G(g,e,p),G(g,s,p),R(s,i),o=!0,r||(l=Bt(s,"click",a[5]),r=!0)},p(g,p){if(h!==(h=g[4][g[3]])){if(t){$t();const _=t;st(_.$$.fragment,1,0,()=>{ft(_,1)}),Ft()}h?(t=_t(h,m()),t.$on("done",g[5]),gt(t.$$.fragment),Q(t.$$.fragment,1),ut(t,e.parentNode,e)):t=null}},i(g){o||(t&&Q(t.$$.fragment,g),o=!0)},o(g){t&&st(t.$$.fragment,g),o=!1},d(g){t&&ft(t,g),g&&E(e),g&&E(s),r=!1,l()}}}function Ae(a){let t,e,s,i,o,r,l=a[2]&&Ot(),h=!a[2]&&a[1]&&Pt(a);return{c(){t=T("div"),l&&l.c(),e=j(),h&&h.c(),s=j(),i=T("canvas"),o=N("Your browser does not support the HTML5 canvas tag."),this.h()},l(m){t=I(m,"DIV",{class:!0});var g=F(t);l&&l.l(g),e=tt(g),h&&h.l(g),s=tt(g),i=I(g,"CANVAS",{width:!0,height:!0,class:!0});var p=F(i);o=W(p,"Your browser does not support the HTML5 canvas tag."),p.forEach(E),g.forEach(E),this.h()},h(){L(i,"width",1024),L(i,"height",512),L(i,"class","svelte-1rfllgf"),St(i,"display",a[1]||a[2]?"none":"block"),L(t,"class","container")},m(m,g){G(m,t,g),l&&l.m(t,null),R(t,e),h&&h.m(t,null),R(t,s),R(t,i),R(i,o),a[6](i),r=!0},p(m,[g]){m[2]?l||(l=Ot(),l.c(),l.m(t,e)):l&&(l.d(1),l=null),!m[2]&&m[1]?h?(h.p(m,g),g&6&&Q(h,1)):(h=Pt(m),h.c(),Q(h,1),h.m(t,s)):h&&($t(),st(h,1,1,()=>{h=null}),Ft()),g&6&&St(i,"display",m[1]||m[2]?"none":"block")},i(m){r||(Q(h),r=!0)},o(m){st(h),r=!1},d(m){m&&E(t),l&&l.d(),h&&h.d(),a[6](null)}}}function De(a,t,e){let s,i,o=!1,r=!1;const l=[Se,jt,ke];let h=0;mt(async()=>{const p=i.getContext("2d");if(p){const _=i.getBoundingClientRect();s=new xe(p,{width:_.width,height:_.height}),await s.loadMap(),s.gameStart(),s.startMinigameCallback=()=>{s.stopListeningControls(),h<l.length?(e(1,o=!0),s.gameState.player&&(s.gameState.player.stopJumping(),s.gameState.player.stopMoveRight(),s.gameState.player.stopMoveLeft())):e(2,r=!0)}}});function m(){e(1,o=!1),e(3,h++,h),s.startListeningControls()}function g(p){pt[p?"unshift":"push"](()=>{i=p,e(0,i)})}return[i,o,r,h,l,m,g]}class Re extends it{constructor(t){super(),at(this,t,De,Ae,nt,{})}}function Te(a){let t,e,s,i,o;return i=new Re({}),{c(){t=T("meta"),e=j(),s=T("section"),gt(i.$$.fragment),this.h()},l(r){const l=Zt("svelte-t32ptj",document.head);t=I(l,"META",{name:!0,content:!0}),l.forEach(E),e=tt(r),s=I(r,"SECTION",{class:!0});var h=F(s);Gt(i.$$.fragment,h),h.forEach(E),this.h()},h(){document.title="Home",L(t,"name","description"),L(t,"content","Svelte demo app"),L(s,"class","svelte-iwe87e")},m(r,l){R(document.head,t),G(r,e,l),G(r,s,l),ut(i,s,null),o=!0},p:q,i(r){o||(Q(i.$$.fragment,r),o=!0)},o(r){st(i.$$.fragment,r),o=!1},d(r){E(t),r&&E(e),r&&E(s),ft(i)}}}class Pe extends it{constructor(t){super(),at(this,t,null,Te,nt,{})}}export{Pe as default};
