var Kt=Object.defineProperty;var Nt=(a,t,e)=>t in a?Kt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>(Nt(a,typeof t!="symbol"?t+"":t,e),e);import{S as it,i as st,s as at,k as I,l as O,m as F,h as b,n as L,b as G,B as H,I as Wt,J as ft,a as Q,c as j,K as lt,L as wt,D as T,M as Pt,o as vt,N as Bt,O as mt,q as N,r as W,u as xt,p as Ct,f as X,g as At,t as et,d as Vt,v as St,w as dt,x as $t,y as gt,z as ut,P as Yt}from"../../chunks/index-b385805f.js";function Mt(a,t,e){const i=a.slice();return i[12]=t[e].flip,i[13]=t[e].name,i[14]=t[e].alt,i[16]=e,i}function _t(a){let t,e,i,s,o,r,l,h,m,g,y;function E(){return a[2](a[16])}return{c(){t=I("div"),e=I("img"),o=Q(),r=I("img"),h=Q(),this.h()},l(S){t=O(S,"DIV",{class:!0,"data-name":!0});var w=F(t);e=O(w,"IMG",{class:!0,src:!0,alt:!0}),o=j(w),r=O(w,"IMG",{class:!0,src:!0,alt:!0}),h=j(w),w.forEach(b),this.h()},h(){L(e,"class","front-face svelte-pdp5dg"),lt(e.src,i="/new-year-game/assets/flip/"+a[13]+".svg")||L(e,"src",i),L(e,"alt",s=a[14]),L(r,"class","back-face svelte-pdp5dg"),lt(r.src,l="/new-year-game/assets/flip/js-badge.svg")||L(r,"src",l),L(r,"alt","Memory Card"),L(t,"class","memory-card svelte-pdp5dg"),L(t,"data-name",m=a[13]),wt(t,"flip",a[12])},m(S,w){G(S,t,w),T(t,e),T(t,o),T(t,r),T(t,h),g||(y=Pt(t,"click",E),g=!0)},p(S,w){a=S,w&1&&!lt(e.src,i="/new-year-game/assets/flip/"+a[13]+".svg")&&L(e,"src",i),w&1&&s!==(s=a[14])&&L(e,"alt",s),w&1&&m!==(m=a[13])&&L(t,"data-name",m),w&1&&wt(t,"flip",a[12])},d(S){S&&b(t),g=!1,y()}}}function Zt(a){let t,e=a[0],i=[];for(let s=0;s<e.length;s+=1)i[s]=_t(Mt(a,e,s));return{c(){t=I("div");for(let s=0;s<i.length;s+=1)i[s].c();this.h()},l(s){t=O(s,"DIV",{class:!0});var o=F(t);for(let r=0;r<i.length;r+=1)i[r].l(o);o.forEach(b),this.h()},h(){L(t,"class","memory-game svelte-pdp5dg")},m(s,o){G(s,t,o);for(let r=0;r<i.length;r+=1)i[r].m(t,null)},p(s,[o]){if(o&3){e=s[0];let r;for(r=0;r<e.length;r+=1){const l=Mt(s,e,r);i[r]?i[r].p(l,o):(i[r]=_t(l),i[r].c(),i[r].m(t,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=e.length}},i:H,o:H,d(s){s&&b(t),Wt(i,s)}}}function Xt(a,t,e){const i=ft();let s=!1,o=!1,r=null,l=null,h=[{name:"react",alt:"React",flip:!1,order:0},{name:"react",alt:"React",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0}];function m(D){if(!o&&r!==D){if(e(0,h[D].flip=!0,h),!s){s=!0,r=D;return}l=D,o=!0,g()}}function g(){r!==null&&l!==null&&(h[r].name===h[l].name?y():E(h[r],h[l]))}function y(){S(),h.some(D=>!D.flip)||i("done")}function E(D,V){setTimeout(()=>{D.flip=!1,V.flip=!1,e(0,h=[...h]),S()},1500)}function S(){s=!1,o=!1,r=null,l=null}return function(){e(0,h=h.map(V=>(V.order=Math.ceil(Math.random()*12),V)).sort((V,Y)=>V.order>Y.order?1:-1))}(),[h,m,D=>m(D)]}class Qt extends it{constructor(t){super(),st(this,t,Xt,Zt,at,{})}}let ot;const jt=new Uint8Array(16);function te(){if(!ot&&(ot=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ot))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ot(jt)}const R=[];for(let a=0;a<256;++a)R.push((a+256).toString(16).slice(1));function ee(a,t=0){return(R[a[t+0]]+R[a[t+1]]+R[a[t+2]]+R[a[t+3]]+"-"+R[a[t+4]]+R[a[t+5]]+"-"+R[a[t+6]]+R[a[t+7]]+"-"+R[a[t+8]]+R[a[t+9]]+"-"+R[a[t+10]]+R[a[t+11]]+R[a[t+12]]+R[a[t+13]]+R[a[t+14]]+R[a[t+15]]).toLowerCase()}const ie=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Et={randomUUID:ie};function Ft(a,t,e){if(Et.randomUUID&&!t&&!a)return Et.randomUUID();a=a||{};const i=a.random||(a.rng||te)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){e=e||0;for(let s=0;s<16;++s)t[e+s]=i[s];return t}return ee(i)}class Gt{constructor(t,e){n(this,"type","");n(this,"id");n(this,"once");n(this,"callback");n(this,"check",t=>!1);this.id=Ft(),this.once=t,this.callback=e}}class se extends Gt{constructor(e,i,s){super(i,s);n(this,"type","collision");n(this,"object");n(this,"check",e=>zt(e,this.object));this.object=e}}class ae extends Gt{constructor(e,i,s,o,r){super(o,r);n(this,"type","edge");n(this,"sign");n(this,"axis");n(this,"value");n(this,"check",e=>this.axis==="x"?this.sign==="gather"?e.vCoordinates.x+e.getLeft()>this.value:e.vCoordinates.x+e.getRight()<this.value:this.sign==="gather"?e.vCoordinates.y+e.getBottom()>this.value:e.vCoordinates.y+e.getTop()<this.value);this.sign=e,this.axis=i,this.value=s}}class nt{constructor(t,e){n(this,"id");n(this,"vCoordinates");n(this,"vVelocity");n(this,"eventListeners",[]);n(this,"draw",(t,e,i)=>{});n(this,"update",(t,e)=>this.checkEventListeners());n(this,"checkEventListeners",()=>{});n(this,"addEventListener",t=>this.eventListeners.push(t));n(this,"removeEventListener",t=>{const e=this.eventListeners.findIndex(({id:i})=>i===t);e>-1&&this.eventListeners.splice(e,1)});this.id=Ft(),this.vCoordinates=t,this.vVelocity=e}}const ct=a=>"width"in a&&"height"in a,Lt=a=>"radius"in a,ne=a=>"isColliding"in a,re=a=>"mass"in a,oe=(a,t)=>!(t.vCoordinates.x>a.width+a.vCoordinates.x||a.vCoordinates.x>t.width+t.vCoordinates.x||t.vCoordinates.y>a.height+a.vCoordinates.y||a.vCoordinates.y>t.height+t.vCoordinates.y),bt=(a,t)=>{const e=t.vCoordinates.getCopy(),{width:i,height:s}=a;return e.x=t.vCoordinates.x<a.vCoordinates.x?a.vCoordinates.x:t.vCoordinates.x>a.vCoordinates.x+i?a.vCoordinates.x+i:e.x,e.y=t.vCoordinates.y<a.vCoordinates.y?a.vCoordinates.y:t.vCoordinates.y>a.vCoordinates.y+s?a.vCoordinates.y+s:e.y,t.vCoordinates.getDistance(e)<=t.radius},he=(a,t)=>a.vCoordinates.getDistance(t.vCoordinates)<=a.radius+t.radius,zt=(a,t)=>{if(Lt(a)){if(Lt(t))return he(a,t);if(ct(t))return bt(t,a)}return ct(a)?ct(t)?oe(a,t):bt(a,t):!1};class C{constructor(t=0,e=0){n(this,"x");n(this,"y");n(this,"getCopy",()=>new C(this.x,this.y));n(this,"getCoordsObject",()=>({x:this.x,y:this.y}));n(this,"setByCoordsObject",({x:t,y:e})=>(this.x=t,this.y=e,this));n(this,"ceil",()=>(this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this));n(this,"divByNumber",t=>new C(this.x/t,this.y/t));n(this,"getDifference",({x:t,y:e})=>new C(this.x-t,this.y-e));n(this,"getDistance",({x:t,y:e})=>{const i=this.x-t,s=this.y-e;return Math.sqrt(i*i+s*s)});this.x=t,this.y=e}getViewCoordinates(t){return new C(this.x,t-this.y)}}class pt extends nt{constructor(e,i,s){super(e,new C);n(this,"width");n(this,"height");n(this,"textures");n(this,"draw",(e,i,s)=>{const o=this.vCoordinates.getViewCoordinates(i);let r=this.height,l=0;for(;r>0;){let h=this.width,m=0;for(;h>0;)e.drawImage(l===0?this.textures.head:this.textures.body,0,0,Math.min(128,h),Math.min(128,r),128*m+o.x-s.x,128*l+o.y-this.height+s.y,Math.min(128,h),Math.min(128,r)),h-=128,m++;r-=128,l++}});n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width);this.width=i.width,this.height=i.height,this.textures=s}}class qt extends pt{constructor(e,i,s,o){super(e,s,o);n(this,"vSpawn");n(this,"lastDistance");n(this,"behavior");n(this,"update",e=>{this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e;const i=this.behavior.vTarget.getDistance(this.vCoordinates);this.lastDistance<i?this.getMoveEndStrategy():this.lastDistance=i});n(this,"getVelocity",()=>{const e=this.behavior.vTarget.getDifference(this.vCoordinates);return e.x===0||e.y===0?e.x!==0?new C(e.x/this.behavior.duration,0):e.y!==0?new C(0,e.y/this.behavior.duration):new C:e.divByNumber(this.behavior.duration)});n(this,"getMoveEndStrategy",()=>{switch(this.behavior.repeat){case"fromStart":{this.vCoordinates=this.vSpawn.getCopy(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}case"fromEnd":{const e=this.vSpawn.getCopy();this.vSpawn=this.behavior.vTarget.getCopy(),this.behavior.vTarget=e,this.vCoordinates=this.vSpawn.getCopy(),this.vVelocity=this.getVelocity(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}default:this.vVelocity=new C}});if(this.vSpawn=e.getCopy(),this.behavior=i,this.lastDistance=i.vTarget.getDistance(this.vSpawn),this.vVelocity=this.getVelocity(),this.behavior.shift){const r=this.behavior.vTarget.getDifference(this.vCoordinates);this.vCoordinates.x+=this.behavior.shift*r.x,this.vCoordinates.x+=this.behavior.shift*r.y}}}class le{constructor(t,e){n(this,"context");n(this,"vViewCoordinates",new C);n(this,"viewPortWidth");n(this,"viewPortHeight");n(this,"gameObjects",[]);n(this,"overlay",null);n(this,"backgroundImage",null);n(this,"time",0);n(this,"secondsPassed",0);n(this,"oldTimeStamp",0);n(this,"start",()=>window.requestAnimationFrame(this.gameLoop));n(this,"gameLoop",t=>{this.overlay?this.overlay.draw(this.context):(this.secondsPassed=(t-this.oldTimeStamp)/1e3,this.time+=this.secondsPassed,this.oldTimeStamp=t,this.gameObjects.forEach(e=>e.update(Math.min(this.secondsPassed,.1),this.vViewCoordinates)),this.detectPlatformCollision(),this.backgroundImage&&this.context.drawImage(this.backgroundImage,0,0,this.viewPortWidth,this.viewPortHeight),this.gameObjects.forEach(e=>e.draw(this.context,this.viewPortHeight,this.vViewCoordinates)),this.drawFps(Math.round(1/this.secondsPassed))),window.requestAnimationFrame(this.gameLoop)});n(this,"drawFps",t=>{this.context.fillStyle="#fff",this.context.font="20px Arial",this.context.textAlign="right",this.context.textBaseline="bottom",this.context.fillText(`fps: ${t}`,this.viewPortWidth-20,30)});n(this,"detectPlatformCollision",()=>{const t=this.gameObjects.filter(i=>i instanceof pt||i instanceof qt),e=this.gameObjects.filter(i=>ne(i)&&re(i));t.forEach(i=>{e.forEach(s=>{zt(i,s)&&(s.vCoordinates.y+s.getBottom()>i.vCoordinates.y+i.getBottom()&&s.vCoordinates.y+s.getTop()>i.vCoordinates.y+i.getTop()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getLeft()&&s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getRight()&&(s.vCoordinates.y=i.vCoordinates.y+i.getTop()-s.getBottom(),s.vVelocity.x=s.vVelocity.x*(1-s.friction),s.vVelocity.y=1,s.platform=i),s.vCoordinates.y+s.getTop()<i.vCoordinates.y+i.getTop()&&s.vCoordinates.y+s.getBottom()<i.vCoordinates.y+i.getBottom()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getLeft()&&s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getRight()&&(s.vCoordinates.y=i.vCoordinates.y-s.getTop(),s.vVelocity.y=-1),s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getLeft()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getLeft()&&s.vCoordinates.y+s.getTop()<i.vCoordinates.y+i.getTop()&&s.vCoordinates.y+s.getBottom()>=i.vCoordinates.y+i.getBottom()&&(s.vCoordinates.x=i.vCoordinates.x-s.getRight(),s.vVelocity.x=-1),s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getRight()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getRight()&&s.vCoordinates.y+s.getTop()<i.vCoordinates.y+i.getTop()&&s.vCoordinates.y+s.getBottom()>=i.vCoordinates.y+i.getBottom()&&(s.vCoordinates.x=i.vCoordinates.x+i.getRight(),s.vVelocity.x=1))})})});n(this,"spawnObject",t=>this.gameObjects.push(t));n(this,"despawnObject",t=>this.gameObjects=this.gameObjects.filter(({id:e})=>t.id!==e));n(this,"worldReset",()=>this.vViewCoordinates=new C);this.context=t,this.viewPortWidth=e.width,this.viewPortHeight=e.height}}const ce=[{id:"santa",position:{x:1e3,y:300}}],de=[{id:"base",type:"static",position:{x:0,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:500,y:-200},size:{width:300,height:400}},{id:"base",type:"static",position:{x:900,y:-200},size:{width:300,height:500}},{id:"base",type:"static",position:{x:900,y:400},size:{width:300,height:250}},{id:"base",type:"static",position:{x:1500,y:-200},size:{width:100,height:525}},{id:"base",type:"static",position:{x:2e3,y:-200},size:{width:100,height:425}},{id:"base",type:"static",position:{x:2300,y:-200},size:{width:250,height:550}},{id:"base",type:"dynamic",position:{x:2600,y:200},size:{width:100,height:20},behavior:{target:{x:3e3,y:200},duation:10,repeat:"fromEnd",duration:10}},{id:"base",type:"dynamic",position:{x:3100,y:300},size:{width:100,height:20},behavior:{target:{x:3500,y:300},duation:10,repeat:"fromEnd",duration:10,shift:1}},{id:"base",type:"static",position:{x:3800,y:100},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4200,y:200},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4600,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:5e3,y:-200},size:{width:200,height:400}}],kt={characters:ce,platforms:de},ge=9.8;class ue extends nt{constructor(e,i){super(e,new C);n(this,"width");n(this,"height");n(this,"friction");n(this,"mass");n(this,"platform",null);n(this,"isColliding",!1);n(this,"sprite");n(this,"time",0);n(this,"column",0);n(this,"row",2);n(this,"horizontalMoveSpeed");n(this,"jumpImpulse");n(this,"isJumping",!1);n(this,"isMoveRight",!1);n(this,"isMoveLeft",!1);n(this,"draw",(e,i,s)=>{const o=this.vCoordinates.getViewCoordinates(i);this.isMoveRight?(this.column=Math.round(this.time*10%8),this.row=11):this.isMoveLeft?(this.column=Math.round(this.time*10%8),this.row=9):(this.row=2,this.column=0);const r=64,l=64;e.drawImage(this.sprite,this.column*r+r/4,this.row*l,r-r/4,l-2,o.x-s.x,o.y-this.height+s.y,this.width,this.height)});n(this,"update",(e,i)=>{this.checkEventListeners(),this.time+=e,this.vVelocity.y-=ge*this.mass*e,this.vVelocity.x=0,this.isMoveRight&&(this.vVelocity.x+=this.horizontalMoveSpeed),this.isMoveLeft&&(this.vVelocity.x-=this.horizontalMoveSpeed),this.platform&&(this.vVelocity.x+=this.platform.vVelocity.x),this.isJumping&&this.platform&&(this.platform=null,this.vVelocity.y=this.jumpImpulse),this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e,i.x=this.vCoordinates.x-250,i.y=this.vCoordinates.y-250});n(this,"checkEventListeners",()=>{this.eventListeners.forEach(e=>{e.check(this)&&(e.once&&this.removeEventListener(e.id),e.callback())})});n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width-16);n(this,"startJumping",()=>this.isJumping=!0);n(this,"stopJumping",()=>this.isJumping=!1);n(this,"startMoveRight",()=>this.isMoveRight=!0);n(this,"stopMoveRight",()=>this.isMoveRight=!1);n(this,"startMoveLeft",()=>this.isMoveLeft=!0);n(this,"stopMoveLeft",()=>this.isMoveLeft=!1);this.sprite=i,this.width=64,this.height=64,this.friction=.1,this.mass=100,this.horizontalMoveSpeed=500,this.jumpImpulse=500}}class fe extends nt{constructor(e,i,s){super(e,i);n(this,"width");n(this,"height");n(this,"isColliding",!1);n(this,"sprite");n(this,"draw",(e,i,s)=>{const o=this.vCoordinates.getViewCoordinates(i);this.isColliding&&(e.fillStyle="grey",e.fillRect(o.x-s.x,o.y-this.height,this.getRight(),this.height));const r=64,l=64;e.drawImage(this.sprite,r,2*l,r-r/4,l-2,o.x-s.x,o.y-this.height+s.y,this.width,this.height)});n(this,"update",()=>null);n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width);this.sprite=s,this.width=64,this.height=64}}class ve extends nt{constructor(e,i,s){super(e,new C);n(this,"width");n(this,"height");n(this,"textures");n(this,"draw",(e,i,s)=>{const o=this.vCoordinates.getViewCoordinates(i);let r=this.height,l=0;for(;r>0;){let h=this.width,m=0;for(;h>0;)e.drawImage(l===0?this.textures.head:this.textures.body,0,0,Math.min(128,h),Math.min(128,r),128*m+o.x-this.width/2,128*l+o.y-this.height+s.y,Math.min(128,h),Math.min(128,r)),h-=128,m++;r-=128,l++}});this.width=i.width,this.height=i.height,this.textures=s}}class me extends nt{constructor(e,i,s){super(e,new C);n(this,"width");n(this,"height");n(this,"texture");n(this,"draw",e=>{e.drawImage(this.texture,0,0,1920,1080,0,0,this.width,this.height);const i=e.createLinearGradient(0,100,0,0);i.addColorStop(0,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=i,e.fillRect(0,this.height,this.width,-100),this.drawText(e),this.drawHelper(e)});n(this,"drawText",e=>{e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.textBaseline="bottom",e.fillText("\u041D\u0443\u0436\u043D\u043E \u043F\u043E\u043C\u043E\u0447\u044C \u0434\u0435\u0434\u0443 \u043C\u043E\u0440\u043E\u0437\u0443! \u041F\u043E\u0433\u043D\u0430\u043B\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u044F\u0442\u044C \u043A\u0432\u0435\u0441\u0442 :D",this.width/2,this.height-50)});n(this,"drawHelper",e=>{e.fillStyle="#ddd",e.font="15px Arial",e.textAlign="right",e.textBaseline="bottom",e.fillText("\u0414\u043B\u044F \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0435\u043D\u0438\u044F \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043F\u0440\u043E\u0431\u0435\u043B",this.width-10,this.height-10)});this.width=i.width,this.height=i.height,this.texture=s}}class pe{constructor(){n(this,"assets",{});n(this,"get",async(t,e="png")=>this.assets[t]||await this.loadAsset(t,e));n(this,"loadAssets",async t=>{const e=await Promise.all(t.map(i=>this.loadAsset(i)));t.map((i,s)=>this.assets[i]=e[s])});n(this,"loadAsset",(t,e="png")=>new Promise(i=>{const s=new Image;s.src=`/new-year-game/assets/${t}.${e}`,s.onload=()=>i(s)}))}}class ye{constructor(t,e){n(this,"context");n(this,"viewPortSize");n(this,"gameDriver");n(this,"assetManager");n(this,"playerRespawn",new C(250,250));n(this,"currentSantaSpawn",0);n(this,"santaSpawnPositions",[new C(2400,350),new C(3800,200),new C(5100,200)]);n(this,"gameState",{isGameOver:!1,level:1});n(this,"gameStart",async()=>(this.gameDriver.backgroundImage=await this.assetManager.get("background","jpg"),await this.spawnPlayer(),this.addSantaMeetingEventListener(),this.addGameOverEventListener(),this.gameDriver.start(),this.gameState));n(this,"loadMap",()=>Promise.all([Promise.all(kt.characters.map(({position:t})=>this.spawnSanta(t))),Promise.all(kt.platforms.map(({id:t,type:e,position:i,behavior:s,size:o})=>e==="static"?this.spawnPlatform(t,i,o):this.spawnMovingPlatform(t,i,s,o))),this.spawnWater()]));n(this,"spawnPlayer",async()=>{let t=[];this.gameState.player&&(t=[...this.gameState.player.eventListeners],this.gameDriver.despawnObject(this.gameState.player)),this.gameState.player=new ue(this.playerRespawn.getCopy(),await this.assetManager.get("characters/player")),this.gameState.player.eventListeners=t,this.gameDriver.spawnObject(this.gameState.player)});n(this,"spawnSanta",async t=>(this.gameState.santa&&this.gameDriver.despawnObject(this.gameState.santa),this.gameState.santa=new fe(new C(t.x,t.y),new C,await this.assetManager.get("characters/santa")),this.gameDriver.spawnObject(this.gameState.santa),this.gameState.santa));n(this,"spawnWater",async()=>{const[t,e]=await Promise.all([this.assetManager.get("water/head"),this.assetManager.get("water/body")]),i=new ve(new C(0,-400),{width:2*this.viewPortSize.width,height:400},{head:t,body:e});return this.gameDriver.spawnObject(i),i});n(this,"spawnOverlay",async()=>{this.gameState.overlay=this.gameDriver.overlay=new me(new C(0,0),this.viewPortSize,await this.assetManager.get("dialog-overlay","jpg"))});n(this,"spawnPlatform",async(t,e,i)=>{const[s,o]=await Promise.all([this.assetManager.get(`platforms/${t}/head`),this.assetManager.get(`platforms/${t}/body`)]),r=new pt(e?new C().setByCoordsObject(e):new C,i||{width:0,height:0},{head:s,body:o});return this.gameDriver.spawnObject(r),r});n(this,"spawnMovingPlatform",async(t,e,i,s)=>{const[o,r]=await Promise.all([this.assetManager.get(`platforms/${t}/head`),this.assetManager.get(`platforms/${t}/body`)]),l=new qt(e?new C().setByCoordsObject(e):new C,i?{...i,vTarget:new C().setByCoordsObject(i.target)}:{vTarget:new C,duration:1,repeat:"none"},s||{width:0,height:0},{head:o,body:r});return this.gameDriver.spawnObject(l),l});n(this,"addGameOverEventListener",()=>{this.gameState.player&&this.gameState.player.addEventListener(new ae("less","y",0,!1,this.spawnPlayer))});n(this,"addSantaMeetingEventListener",()=>{this.gameState.player&&this.gameState.santa&&this.gameState.player.addEventListener(new se(this.gameState.santa,!0,this.spawnOverlay))});n(this,"startMiniGame",()=>{this.gameState.santa&&this.gameState.player&&this.gameDriver.overlay&&(delete this.gameState.overlay,this.gameDriver.overlay=null,this.playerRespawn=this.gameState.santa.vCoordinates.getCopy(),this.currentSantaSpawn<3&&(this.gameState.santa.vCoordinates=this.santaSpawnPositions[this.currentSantaSpawn++].getCopy(),this.addSantaMeetingEventListener()),this.startMinigameCallback())});n(this,"startMinigameCallback",()=>{});this.context=t,this.viewPortSize=e,this.gameDriver=new le(t,e),this.assetManager=new pe}}function we(a){let t;return{c(){t=I("canvas"),this.h()},l(e){t=O(e,"CANVAS",{width:!0,height:!0,id:!0}),F(t).forEach(b),this.h()},h(){L(t,"width","271"),L(t,"height","392"),L(t,"id","game")},m(e,i){G(e,t,i),a[1](t)},p:H,i:H,o:H,d(e){e&&b(t),a[1](null)}}}const _=32,Dt=1,A=4;function J(a){return a*Math.PI/180}function Z(a,t,e){let i=Math.sin(e),s=Math.cos(e);return{x:a*s-t*i,y:a*i+t*s}}function Rt(a,t){return a=Math.ceil(a),t=Math.floor(t),Math.floor(Math.random()*(t-a+1))+a}function Jt(a,t){const e=a.x-t.x,i=a.y-t.y;return Math.sqrt(e*e+i*i)}function Tt(a,t){return Jt(a,t)<a.radius+t.radius}function xe(a,t,e){var yt;const i=ft();let s,o;const r=[],l={R:"red",G:"green",B:"blue",Y:"yellow"},h=Object.keys(l),m=Object.values(l),g=[];let y=[];E();function E(){for(let c=0;c<5;c++){const M=c%2===0?8:7,f=[];for(let x=0;x<M;x++)f.push(h[Rt(0,m.length-1)]);r.push(f)}}function S(c,M=!1){const f=g.filter(x=>x.active==M&&Tt(c,x));if(!!f.length)return f.map(x=>({distance:Jt(c,x),bubble:x})).sort((x,B)=>x.distance-B.distance)[0].bubble}function w(c,M,f){const x=Math.floor(M/_),B=Math.floor(c/_),ht=x%2===0?0:.5*_,K=_/2;g.push({x:A+(_+Dt)*B+ht+K,y:A+(_+Dt-4)*x+K,radius:_/2,color:f,active:!!f})}function D(c){const M=[],f=[Z(_,0,0),Z(_,0,J(60)),Z(_,0,J(120)),Z(_,0,J(180)),Z(_,0,J(240)),Z(_,0,J(300))];for(let x=0;x<f.length;x++){const B=f[x],ht={x:c.x+B.x,y:c.y+B.y,radius:c.radius},K=S(ht,!0);K&&K!==c&&!M.includes(K)&&M.push(K)}return M}function V(c){const M=[c];g.forEach(x=>x.processed=!1),c.processed=!0;let f=D(c);for(let x=0;x<f.length;x++){let B=f[x];B.processed||(B.processed=!0,B.color===c.color&&(M.push(B),f=f.concat(D(B))))}M.length>=3&&M.forEach(x=>{x.active=!1})}function Y(){const c=g.filter(f=>f.active);c.forEach(f=>f.processed=!1);let M=c.filter(f=>f.y-_<=A);for(let f=0;f<M.length;f++){let x=M[f];x.processed||(x.processed=!0,M=M.concat(D(x)))}c.filter(f=>!f.processed).forEach(f=>{f.active=!1,y.push({x:f.x,y:f.y,color:f.color,radius:f.radius,active:!0})})}for(let c=0;c<10;c++)for(let M=0;M<(c%2===0?8:7);M++){const f=(yt=r[c])==null?void 0:yt[M];w(M*_,c*_,l[f])}let v,p,P=0;const tt=J(-60),rt=J(60);let z=0;function d(){p.x=v.x,p.y=v.y,p.dx=p.dy=0;const c=g.filter(f=>f.active).map(({color:f})=>f).reduce((f,x)=>f.includes(x)?f:[...f,x],[]),M=Rt(0,c.length-1);p.color=c[M],c.length===0&&i("done")}function u(c){c.color=p.color,c.active=!0,V(c),Y(),d()}let k;vt(()=>{if(!s)return;const c=s.getContext("2d");c&&(o=c),v={x:s.width/2,y:s.height-_*1.5},p={x:v.x,y:v.y,color:"red",radius:_/2,speed:8,dx:0,dy:0},window.addEventListener("keydown",q),window.addEventListener("keyup",Ut),k=requestAnimationFrame($)}),Bt(()=>cancelAnimationFrame(k));function $(){if(k=requestAnimationFrame($),o.clearRect(0,0,s.width,s.height),P=P+J(2)*z,P<tt?P=tt:P>rt&&(P=rt),p.x+=p.dx,p.y+=p.dy,p.x-_/2<A?(p.x=A+_/2,p.dx*=-1):p.x+_/2>s.width-A&&(p.x=s.width-A-_/2,p.dx*=-1),p.y-_/2<A){const c=S(p);u(c)}for(let c=0;c<g.length;c++){const M=g[c];if(M.active&&Tt(p,M)){const f=S(p);f||(window.alert("Game Over"),window.location.reload()),f&&u(f)}}y.forEach(c=>{c.y+=8}),y=y.filter(c=>c.y<s.height-_/2),o.fillStyle="lightgrey",o.fillRect(0,0,s.width,A),o.fillRect(0,0,A,s.height),o.fillRect(s.width-A,0,A,s.height),g.concat(y).forEach(c=>{!c.active||(o.fillStyle=c.color,o.beginPath(),o.arc(c.x,c.y,c.radius,0,2*Math.PI),o.fill())}),o.save(),o.translate(v.x,v.y),o.rotate(P),o.translate(0,-_/2*4.5),o.strokeStyle="white",o.lineWidth=2,o.beginPath(),o.moveTo(0,0),o.lineTo(0,_*2),o.moveTo(0,0),o.lineTo(-10,_*.4),o.moveTo(0,0),o.lineTo(10,_*.4),o.stroke(),o.restore(),o.fillStyle=p.color,o.beginPath(),o.arc(p.x,p.y,p.radius,0,2*Math.PI),o.fill()}const q=c=>{c.code==="ArrowLeft"?z=-1:c.code==="ArrowRight"&&(z=1),c.code==="Space"&&p.dx===0&&p.dy===0&&(p.dx=Math.sin(P)*p.speed,p.dy=-Math.cos(P)*p.speed)},Ut=c=>{(c.code==="ArrowLeft"&&z===-1||c.code==="ArrowRight"&&z===1)&&(z=0)};function Ht(c){mt[c?"unshift":"push"](()=>{s=c,e(0,s)})}return[s,Ht]}class Ce extends it{constructor(t){super(),st(this,t,xe,we,at,{})}}function Se(a){let t,e,i,s,o,r;return{c(){t=I("div"),e=I("canvas"),i=N(`\r
  Score: `),s=N(a[1]),o=N("/"),r=N(a[0]),this.h()},l(l){t=O(l,"DIV",{});var h=F(t);e=O(h,"CANVAS",{width:!0,height:!0,id:!0,class:!0}),F(e).forEach(b),i=W(h,`\r
  Score: `),s=W(h,a[1]),o=W(h,"/"),r=W(h,a[0]),h.forEach(b),this.h()},h(){L(e,"width","320"),L(e,"height","640"),L(e,"id","game"),L(e,"class","svelte-ny48w9")},m(l,h){G(l,t,h),T(t,e),a[3](e),T(t,i),T(t,s),T(t,o),T(t,r)},p(l,[h]){h&2&&xt(s,l[1]),h&1&&xt(r,l[0])},i:H,o:H,d(l){l&&b(t),a[3](null)}}}const U=32;function Me(a,t){return a=Math.ceil(a),t=Math.floor(t),Math.floor(Math.random()*(t-a+1))+a}function _e(a){const t=a.length-1;return a.map((i,s)=>i.map((o,r)=>a[t-r][s]))}function Ee(a,t,e){const i=ft();let{target:s=10}=t,o=0;function r(){const d=["I","J","L","O","S","T","Z"];for(;d.length;){const u=Me(0,d.length-1),k=d.splice(u,1)[0];S.push(k)}}function l(){S.length===0&&r();const d=S.pop(),u=D[d],k=w[0].length/2-Math.ceil(u[0].length/2);return{name:d,matrix:u,row:d==="I"?-1:-2,col:k}}function h(d,u,k){for(let $=0;$<d.length;$++)for(let q=0;q<d[$].length;q++)if(d[$][q]&&(k+q<0||k+q>=w[0].length||u+$>=w.length||w[u+$][k+q]))return!1;return!0}function m(){for(let d=0;d<v.matrix.length;d++)for(let u=0;u<v.matrix[d].length;u++)if(v.matrix[d][u]){if(v.row+d<0)return g();w[v.row+d][v.col+u]=v.name}for(let d=w.length-1;d>=0;)if(w[d].every(u=>!!u)){for(let u=d;u>=0;u--)for(let k=0;k<w[u].length;k++)w[u][k]=w[u-1][k];e(1,o++,o),o>=s&&i("done")}else d--;v=l()}function g(){cancelAnimationFrame(p),P=!0,E.fillStyle="black",E.globalAlpha=.75,E.fillRect(0,y.height/2-30,y.width,60),E.globalAlpha=1,E.fillStyle="white",E.font="36px monospace",E.textAlign="center",E.textBaseline="middle",E.fillText("GAME OVER!",y.width/2,y.height/2)}let y,E;const S=[],w=[];for(let d=-2;d<20;d++){w[d]=[];for(let u=0;u<10;u++)w[d][u]=0}const D={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]]},V={I:"cyan",O:"yellow",T:"purple",S:"green",Z:"red",J:"blue",L:"orange"};let Y=0,v=l(),p=null,P=!1;vt(()=>{if(!y)return;const d=y.getContext("2d");d&&(E=d),p=requestAnimationFrame(tt),window.addEventListener("keydown",rt)}),Bt(()=>cancelAnimationFrame(p));function tt(){p=requestAnimationFrame(tt),E.clearRect(0,0,y.width,y.height);for(let d=0;d<20;d++)for(let u=0;u<10;u++)if(w[d][u]){const k=w[d][u];E.fillStyle=V[k],E.fillRect(u*U,d*U,U-1,U-1)}if(v){++Y>35&&(v.row++,Y=0,h(v.matrix,v.row,v.col)||(v.row--,m())),E.fillStyle=V[v.name];for(let d=0;d<v.matrix.length;d++)for(let u=0;u<v.matrix[d].length;u++)v.matrix[d][u]&&E.fillRect((v.col+u)*U,(v.row+d)*U,U-1,U-1)}}const rt=d=>{if(!P){if(d.which===37||d.which===39){const u=d.which===37?v.col-1:v.col+1;h(v.matrix,v.row,u)&&(v.col=u)}if(d.which===38){const u=_e(v.matrix);h(u,v.row,v.col)&&(v.matrix=u)}if(d.which===40){const u=v.row+1;if(!h(v.matrix,u,v.col)){v.row=u-1,m();return}v.row=u}}};function z(d){mt[d?"unshift":"push"](()=>{y=d,e(2,y)})}return a.$$set=d=>{"target"in d&&e(0,s=d.target)},[s,o,y,z]}class Le extends it{constructor(t){super(),st(this,t,Ee,Se,at,{target:0})}}function It(a){let t,e;return{c(){t=I("h1"),e=N("\u0412\u044B \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438! \u0421 \u041D\u043E\u0432\u044B\u043C \u0413\u043E\u0434\u043E\u043C!")},l(i){t=O(i,"H1",{});var s=F(t);e=W(s,"\u0412\u044B \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438! \u0421 \u041D\u043E\u0432\u044B\u043C \u0413\u043E\u0434\u043E\u043C!"),s.forEach(b)},m(i,s){G(i,t,s),T(t,e)},d(i){i&&b(t)}}}function Ot(a){let t,e,i,s,o,r,l;var h=a[4][a[3]];function m(g){return{}}return h&&(t=St(h,m()),t.$on("done",a[5])),{c(){t&&dt(t.$$.fragment),e=Q(),i=I("button"),s=N("Skip minigame")},l(g){t&&$t(t.$$.fragment,g),e=j(g),i=O(g,"BUTTON",{});var y=F(i);s=W(y,"Skip minigame"),y.forEach(b)},m(g,y){t&&gt(t,g,y),G(g,e,y),G(g,i,y),T(i,s),o=!0,r||(l=Pt(i,"click",a[5]),r=!0)},p(g,y){if(h!==(h=g[4][g[3]])){if(t){At();const E=t;et(E.$$.fragment,1,0,()=>{ut(E,1)}),Vt()}h?(t=St(h,m()),t.$on("done",g[5]),dt(t.$$.fragment),X(t.$$.fragment,1),gt(t,e.parentNode,e)):t=null}},i(g){o||(t&&X(t.$$.fragment,g),o=!0)},o(g){t&&et(t.$$.fragment,g),o=!1},d(g){t&&ut(t,g),g&&b(e),g&&b(i),r=!1,l()}}}function be(a){let t,e,i,s,o,r,l=a[2]&&It(),h=!a[2]&&a[1]&&Ot(a);return{c(){t=I("div"),l&&l.c(),e=Q(),h&&h.c(),i=Q(),s=I("canvas"),o=N("Your browser does not support the HTML5 canvas tag."),this.h()},l(m){t=O(m,"DIV",{class:!0});var g=F(t);l&&l.l(g),e=j(g),h&&h.l(g),i=j(g),s=O(g,"CANVAS",{width:!0,height:!0,class:!0});var y=F(s);o=W(y,"Your browser does not support the HTML5 canvas tag."),y.forEach(b),g.forEach(b),this.h()},h(){L(s,"width",1024),L(s,"height",512),L(s,"class","svelte-1rfllgf"),Ct(s,"display",a[1]||a[2]?"none":"block"),L(t,"class","container")},m(m,g){G(m,t,g),l&&l.m(t,null),T(t,e),h&&h.m(t,null),T(t,i),T(t,s),T(s,o),a[6](s),r=!0},p(m,[g]){m[2]?l||(l=It(),l.c(),l.m(t,e)):l&&(l.d(1),l=null),!m[2]&&m[1]?h?(h.p(m,g),g&6&&X(h,1)):(h=Ot(m),h.c(),X(h,1),h.m(t,i)):h&&(At(),et(h,1,1,()=>{h=null}),Vt()),g&6&&Ct(s,"display",m[1]||m[2]?"none":"block")},i(m){r||(X(h),r=!0)},o(m){et(h),r=!1},d(m){m&&b(t),l&&l.d(),h&&h.d(),a[6](null)}}}function ke(a,t,e){let i,s,o=!1,r=!1;const l=[Ce,Qt,Le];let h=0;vt(async()=>{const S=s.getContext("2d");if(S){const w=s.getBoundingClientRect();i=new ye(S,{width:w.width,height:w.height}),await i.loadMap(),i.gameStart(),i.startMinigameCallback=()=>{h<l.length?(e(1,o=!0),i.gameState.player&&(i.gameState.player.stopJumping(),i.gameState.player.stopMoveRight(),i.gameState.player.stopMoveLeft())):e(2,r=!0)},window.addEventListener("keydown",g),window.addEventListener("keyup",y)}});function m(){e(1,o=!1),e(3,h++,h)}function g(S){if(i.gameState&&i.gameState.player&&!o)switch(S.code){case"KeyW":i.gameState.player.startJumping();break;case"KeyD":i.gameState.player.startMoveRight();break;case"KeyA":i.gameState.player.startMoveLeft();break;case"Space":i.startMiniGame();break}}function y(S){if(i.gameState&&i.gameState.player&&!o)switch(S.code){case"KeyW":i.gameState.player.stopJumping();break;case"KeyD":i.gameState.player.stopMoveRight();break;case"KeyA":i.gameState.player.stopMoveLeft();break}}function E(S){mt[S?"unshift":"push"](()=>{s=S,e(0,s)})}return[s,o,r,h,l,m,E]}class De extends it{constructor(t){super(),st(this,t,ke,be,at,{})}}function Re(a){let t,e,i,s,o;return s=new De({}),{c(){t=I("meta"),e=Q(),i=I("section"),dt(s.$$.fragment),this.h()},l(r){const l=Yt("svelte-t32ptj",document.head);t=O(l,"META",{name:!0,content:!0}),l.forEach(b),e=j(r),i=O(r,"SECTION",{class:!0});var h=F(i);$t(s.$$.fragment,h),h.forEach(b),this.h()},h(){document.title="Home",L(t,"name","description"),L(t,"content","Svelte demo app"),L(i,"class","svelte-iwe87e")},m(r,l){T(document.head,t),G(r,e,l),G(r,i,l),gt(s,i,null),o=!0},p:H,i(r){o||(X(s.$$.fragment,r),o=!0)},o(r){et(s.$$.fragment,r),o=!1},d(r){b(t),r&&b(e),r&&b(i),ut(s)}}}class Oe extends it{constructor(t){super(),st(this,t,null,Re,at,{})}}export{Oe as default};
