var qt=Object.defineProperty;var Jt=(a,t,e)=>t in a?qt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>(Jt(a,typeof t!="symbol"?t+"":t,e),e);import{S as et,i as it,s as st,k as I,l as P,m as V,h as R,n as b,b as $,B as U,I as Ut,J as ft,a as X,c as Q,K as lt,L as yt,D as T,M as Bt,o as vt,N as It,O as mt,q as K,r as W,u as wt,p as xt,f as Z,g as Pt,t as tt,d as Ot,v as Ct,w as dt,x as At,y as gt,z as ut,P as Ht}from"../../chunks/index-b385805f.js";function St(a,t,e){const i=a.slice();return i[12]=t[e].flip,i[13]=t[e].name,i[14]=t[e].alt,i[16]=e,i}function Mt(a){let t,e,i,s,r,o,l,h,v,g,w;function S(){return a[2](a[16])}return{c(){t=I("div"),e=I("img"),r=X(),o=I("img"),h=X(),this.h()},l(_){t=P(_,"DIV",{class:!0,"data-name":!0});var y=V(t);e=P(y,"IMG",{class:!0,src:!0,alt:!0}),r=Q(y),o=P(y,"IMG",{class:!0,src:!0,alt:!0}),h=Q(y),y.forEach(R),this.h()},h(){b(e,"class","front-face svelte-pdp5dg"),lt(e.src,i="src/lib/images/flip/"+a[13]+".svg")||b(e,"src",i),b(e,"alt",s=a[14]),b(o,"class","back-face svelte-pdp5dg"),lt(o.src,l="src/lib/images/flip/js-badge.svg")||b(o,"src",l),b(o,"alt","Memory Card"),b(t,"class","memory-card svelte-pdp5dg"),b(t,"data-name",v=a[13]),yt(t,"flip",a[12])},m(_,y){$(_,t,y),T(t,e),T(t,r),T(t,o),T(t,h),g||(w=Bt(t,"click",S),g=!0)},p(_,y){a=_,y&1&&!lt(e.src,i="src/lib/images/flip/"+a[13]+".svg")&&b(e,"src",i),y&1&&s!==(s=a[14])&&b(e,"alt",s),y&1&&v!==(v=a[13])&&b(t,"data-name",v),y&1&&yt(t,"flip",a[12])},d(_){_&&R(t),g=!1,w()}}}function Nt(a){let t,e=a[0],i=[];for(let s=0;s<e.length;s+=1)i[s]=Mt(St(a,e,s));return{c(){t=I("div");for(let s=0;s<i.length;s+=1)i[s].c();this.h()},l(s){t=P(s,"DIV",{class:!0});var r=V(t);for(let o=0;o<i.length;o+=1)i[o].l(r);r.forEach(R),this.h()},h(){b(t,"class","memory-game svelte-pdp5dg")},m(s,r){$(s,t,r);for(let o=0;o<i.length;o+=1)i[o].m(t,null)},p(s,[r]){if(r&3){e=s[0];let o;for(o=0;o<e.length;o+=1){const l=St(s,e,o);i[o]?i[o].p(l,r):(i[o]=Mt(l),i[o].c(),i[o].m(t,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=e.length}},i:U,o:U,d(s){s&&R(t),Ut(i,s)}}}function Kt(a,t,e){const i=ft();let s=!1,r=!1,o=null,l=null,h=[{name:"react",alt:"React",flip:!1,order:0},{name:"react",alt:"React",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0}];function v(L){if(!r&&o!==L){if(e(0,h[L].flip=!0,h),!s){s=!0,o=L;return}l=L,r=!0,g()}}function g(){o!==null&&l!==null&&(h[o].name===h[l].name?w():S(h[o],h[l]))}function w(){_(),h.some(L=>!L.flip)||i("done")}function S(L,m){setTimeout(()=>{L.flip=!1,m.flip=!1,e(0,h=[...h]),_()},1500)}function _(){s=!1,r=!1,o=null,l=null}return function(){e(0,h=h.map(m=>(m.order=Math.ceil(Math.random()*12),m)).sort((m,B)=>m.order>B.order?1:-1))}(),[h,v,L=>v(L)]}class Wt extends et{constructor(t){super(),it(this,t,Kt,Nt,st,{})}}let ot;const Yt=new Uint8Array(16);function Zt(){if(!ot&&(ot=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ot))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ot(Yt)}const k=[];for(let a=0;a<256;++a)k.push((a+256).toString(16).slice(1));function Xt(a,t=0){return(k[a[t+0]]+k[a[t+1]]+k[a[t+2]]+k[a[t+3]]+"-"+k[a[t+4]]+k[a[t+5]]+"-"+k[a[t+6]]+k[a[t+7]]+"-"+k[a[t+8]]+k[a[t+9]]+"-"+k[a[t+10]]+k[a[t+11]]+k[a[t+12]]+k[a[t+13]]+k[a[t+14]]+k[a[t+15]]).toLowerCase()}const Qt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_t={randomUUID:Qt};function Vt(a,t,e){if(_t.randomUUID&&!t&&!a)return _t.randomUUID();a=a||{};const i=a.random||(a.rng||Zt)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){e=e||0;for(let s=0;s<16;++s)t[e+s]=i[s];return t}return Xt(i)}class $t{constructor(t,e){n(this,"type","");n(this,"id");n(this,"once");n(this,"callback");n(this,"check",t=>!1);this.id=Vt(),this.once=t,this.callback=e}}class jt extends $t{constructor(e,i,s){super(i,s);n(this,"type","collision");n(this,"object");n(this,"check",e=>Gt(e,this.object));this.object=e}}class te extends $t{constructor(e,i,s,r,o){super(r,o);n(this,"type","edge");n(this,"sign");n(this,"axis");n(this,"value");n(this,"check",e=>this.axis==="x"?this.sign==="gather"?e.vCoordinates.x+e.getLeft()>this.value:e.vCoordinates.x+e.getRight()<this.value:this.sign==="gather"?e.vCoordinates.y+e.getBottom()>this.value:e.vCoordinates.y+e.getTop()<this.value);this.sign=e,this.axis=i,this.value=s}}class at{constructor(t,e){n(this,"id");n(this,"vCoordinates");n(this,"vVelocity");n(this,"eventListeners",[]);n(this,"draw",(t,e,i)=>{});n(this,"update",(t,e)=>this.checkEventListeners());n(this,"checkEventListeners",()=>{});n(this,"addEventListener",t=>this.eventListeners.push(t));n(this,"removeEventListener",t=>{const e=this.eventListeners.findIndex(({id:i})=>i===t);e>-1&&this.eventListeners.splice(e,1)});this.id=Vt(),this.vCoordinates=t,this.vVelocity=e}}const ct=a=>"width"in a&&"height"in a,Et=a=>"radius"in a,ee=a=>"isColliding"in a,ie=a=>"mass"in a,se=(a,t)=>!(t.vCoordinates.x>a.width+a.vCoordinates.x||a.vCoordinates.x>t.width+t.vCoordinates.x||t.vCoordinates.y>a.height+a.vCoordinates.y||a.vCoordinates.y>t.height+t.vCoordinates.y),bt=(a,t)=>{const e=t.vCoordinates.getCopy(),{width:i,height:s}=a;return e.x=t.vCoordinates.x<a.vCoordinates.x?a.vCoordinates.x:t.vCoordinates.x>a.vCoordinates.x+i?a.vCoordinates.x+i:e.x,e.y=t.vCoordinates.y<a.vCoordinates.y?a.vCoordinates.y:t.vCoordinates.y>a.vCoordinates.y+s?a.vCoordinates.y+s:e.y,t.vCoordinates.getDistance(e)<=t.radius},ae=(a,t)=>a.vCoordinates.getDistance(t.vCoordinates)<=a.radius+t.radius,Gt=(a,t)=>{if(Et(a)){if(Et(t))return ae(a,t);if(ct(t))return bt(t,a)}return ct(a)?ct(t)?se(a,t):bt(a,t):!1};class C{constructor(t=0,e=0){n(this,"x");n(this,"y");n(this,"getCopy",()=>new C(this.x,this.y));n(this,"getCoordsObject",()=>({x:this.x,y:this.y}));n(this,"setByCoordsObject",({x:t,y:e})=>(this.x=t,this.y=e,this));n(this,"ceil",()=>(this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this));n(this,"divByNumber",t=>new C(this.x/t,this.y/t));n(this,"getDifference",({x:t,y:e})=>new C(this.x-t,this.y-e));n(this,"getDistance",({x:t,y:e})=>{const i=this.x-t,s=this.y-e;return Math.sqrt(i*i+s*s)});this.x=t,this.y=e}getViewCoordinates(t){return new C(this.x,t-this.y)}}class pt extends at{constructor(e,i,s){super(e,new C);n(this,"width");n(this,"height");n(this,"textures");n(this,"draw",(e,i,s)=>{const r=this.vCoordinates.getViewCoordinates(i);let o=this.height,l=0;for(;o>0;){let h=this.width,v=0;for(;h>0;)e.drawImage(l===0?this.textures.head:this.textures.body,0,0,Math.min(128,h),Math.min(128,o),128*v+r.x-s.x,128*l+r.y-this.height+s.y,Math.min(128,h),Math.min(128,o)),h-=128,v++;o-=128,l++}});n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width);this.width=i.width,this.height=i.height,this.textures=s}}class Ft extends pt{constructor(e,i,s,r){super(e,s,r);n(this,"vSpawn");n(this,"lastDistance");n(this,"behavior");n(this,"update",e=>{this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e;const i=this.behavior.vTarget.getDistance(this.vCoordinates);this.lastDistance<i?this.getMoveEndStrategy():this.lastDistance=i});n(this,"getVelocity",()=>{const e=this.behavior.vTarget.getDifference(this.vCoordinates);return e.x===0||e.y===0?e.x!==0?new C(e.x/this.behavior.duration,0):e.y!==0?new C(0,e.y/this.behavior.duration):new C:e.divByNumber(this.behavior.duration)});n(this,"getMoveEndStrategy",()=>{switch(this.behavior.repeat){case"fromStart":{this.vCoordinates=this.vSpawn.getCopy(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}case"fromEnd":{const e=this.vSpawn.getCopy();this.vSpawn=this.behavior.vTarget.getCopy(),this.behavior.vTarget=e,this.vCoordinates=this.vSpawn.getCopy(),this.vVelocity=this.getVelocity(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}default:this.vVelocity=new C}});if(this.vSpawn=e.getCopy(),this.behavior=i,this.lastDistance=i.vTarget.getDistance(this.vSpawn),this.vVelocity=this.getVelocity(),this.behavior.shift){const o=this.behavior.vTarget.getDifference(this.vCoordinates);this.vCoordinates.x+=this.behavior.shift*o.x,this.vCoordinates.x+=this.behavior.shift*o.y}}}class ne{constructor(t,e){n(this,"context");n(this,"vViewCoordinates",new C);n(this,"viewPortWidth");n(this,"viewPortHeight");n(this,"gameObjects",[]);n(this,"overlay",null);n(this,"backgroundImage",null);n(this,"time",0);n(this,"secondsPassed",0);n(this,"oldTimeStamp",0);n(this,"start",()=>window.requestAnimationFrame(this.gameLoop));n(this,"gameLoop",t=>{this.overlay?this.overlay.draw(this.context):(this.secondsPassed=(t-this.oldTimeStamp)/1e3,this.time+=this.secondsPassed,this.oldTimeStamp=t,this.gameObjects.forEach(e=>e.update(Math.min(this.secondsPassed,.1),this.vViewCoordinates)),this.detectPlatformCollision(),this.backgroundImage&&this.context.drawImage(this.backgroundImage,0,0,this.viewPortWidth,this.viewPortHeight),this.gameObjects.forEach(e=>e.draw(this.context,this.viewPortHeight,this.vViewCoordinates)),this.drawFps(Math.round(1/this.secondsPassed))),window.requestAnimationFrame(this.gameLoop)});n(this,"drawFps",t=>{this.context.fillStyle="#fff",this.context.font="20px Arial",this.context.textAlign="right",this.context.textBaseline="bottom",this.context.fillText(`fps: ${t}`,this.viewPortWidth-20,30)});n(this,"detectPlatformCollision",()=>{const t=this.gameObjects.filter(i=>i instanceof pt||i instanceof Ft),e=this.gameObjects.filter(i=>ee(i)&&ie(i));t.forEach(i=>{e.forEach(s=>{Gt(i,s)&&(s.vCoordinates.y+s.getBottom()>i.vCoordinates.y+i.getBottom()&&s.vCoordinates.y+s.getTop()>i.vCoordinates.y+i.getTop()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getLeft()&&s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getRight()&&(s.vCoordinates.y=i.vCoordinates.y+i.getTop()-s.getBottom(),s.vVelocity.x=s.vVelocity.x*(1-s.friction),s.vVelocity.y=1,s.platform=i),s.vCoordinates.y+s.getTop()<i.vCoordinates.y+i.getTop()&&s.vCoordinates.y+s.getBottom()<i.vCoordinates.y+i.getBottom()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getLeft()&&s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getRight()&&(s.vCoordinates.y=i.vCoordinates.y-s.getTop(),s.vVelocity.y=-1),s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getLeft()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getLeft()&&s.vCoordinates.y+s.getTop()<i.vCoordinates.y+i.getTop()&&s.vCoordinates.y+s.getBottom()>=i.vCoordinates.y+i.getBottom()&&(s.vCoordinates.x=i.vCoordinates.x-s.getRight(),s.vVelocity.x=-1),s.vCoordinates.x+s.getLeft()<i.vCoordinates.x+i.getRight()&&s.vCoordinates.x+s.getRight()>i.vCoordinates.x+i.getRight()&&s.vCoordinates.y+s.getTop()<i.vCoordinates.y+i.getTop()&&s.vCoordinates.y+s.getBottom()>=i.vCoordinates.y+i.getBottom()&&(s.vCoordinates.x=i.vCoordinates.x+i.getRight(),s.vVelocity.x=1))})})});n(this,"spawnObject",t=>this.gameObjects.push(t));n(this,"despawnObject",t=>this.gameObjects=this.gameObjects.filter(({id:e})=>t.id!==e));n(this,"worldReset",()=>this.vViewCoordinates=new C);this.context=t,this.viewPortWidth=e.width,this.viewPortHeight=e.height}}const re=[{id:"santa",position:{x:1e3,y:300}}],oe=[{id:"base",type:"static",position:{x:0,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:500,y:-200},size:{width:300,height:400}},{id:"base",type:"static",position:{x:900,y:-200},size:{width:300,height:500}},{id:"base",type:"static",position:{x:900,y:400},size:{width:300,height:250}},{id:"base",type:"static",position:{x:1500,y:-200},size:{width:100,height:525}},{id:"base",type:"static",position:{x:2e3,y:-200},size:{width:100,height:425}},{id:"base",type:"static",position:{x:2300,y:-200},size:{width:250,height:550}},{id:"base",type:"dynamic",position:{x:2600,y:200},size:{width:100,height:20},behavior:{target:{x:3e3,y:200},duation:10,repeat:"fromEnd",duration:10}},{id:"base",type:"dynamic",position:{x:3100,y:300},size:{width:100,height:20},behavior:{target:{x:3500,y:300},duation:10,repeat:"fromEnd",duration:10,shift:1}},{id:"base",type:"static",position:{x:3800,y:100},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4200,y:200},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4600,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:5e3,y:-200},size:{width:200,height:400}}],Rt={characters:re,platforms:oe},he=9.8;class le extends at{constructor(e,i){super(e,new C);n(this,"width");n(this,"height");n(this,"friction");n(this,"mass");n(this,"platform",null);n(this,"isColliding",!1);n(this,"sprite");n(this,"time",0);n(this,"column",0);n(this,"row",2);n(this,"horizontalMoveSpeed");n(this,"jumpImpulse");n(this,"isJumping",!1);n(this,"isMoveRight",!1);n(this,"isMoveLeft",!1);n(this,"draw",(e,i,s)=>{const r=this.vCoordinates.getViewCoordinates(i);this.isMoveRight?(this.column=Math.round(this.time*10%8),this.row=11):this.isMoveLeft?(this.column=Math.round(this.time*10%8),this.row=9):(this.row=2,this.column=0);const o=64,l=64;e.drawImage(this.sprite,this.column*o+o/4,this.row*l,o-o/4,l-2,r.x-s.x,r.y-this.height+s.y,this.width,this.height)});n(this,"update",(e,i)=>{this.checkEventListeners(),this.time+=e,this.vVelocity.y-=he*this.mass*e,this.vVelocity.x=0,this.isMoveRight&&(this.vVelocity.x+=this.horizontalMoveSpeed),this.isMoveLeft&&(this.vVelocity.x-=this.horizontalMoveSpeed),this.platform&&(this.vVelocity.x+=this.platform.vVelocity.x),this.isJumping&&this.platform&&(this.platform=null,this.vVelocity.y=this.jumpImpulse),this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e,i.x=this.vCoordinates.x-250,i.y=this.vCoordinates.y-250});n(this,"checkEventListeners",()=>{this.eventListeners.forEach(e=>{e.check(this)&&(e.once&&this.removeEventListener(e.id),e.callback())})});n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width-16);n(this,"startJumping",()=>this.isJumping=!0);n(this,"stopJumping",()=>this.isJumping=!1);n(this,"startMoveRight",()=>this.isMoveRight=!0);n(this,"stopMoveRight",()=>this.isMoveRight=!1);n(this,"startMoveLeft",()=>this.isMoveLeft=!0);n(this,"stopMoveLeft",()=>this.isMoveLeft=!1);this.sprite=i,this.width=64,this.height=64,this.friction=.1,this.mass=100,this.horizontalMoveSpeed=500,this.jumpImpulse=500}}class ce extends at{constructor(e,i,s){super(e,i);n(this,"width");n(this,"height");n(this,"isColliding",!1);n(this,"sprite");n(this,"draw",(e,i,s)=>{const r=this.vCoordinates.getViewCoordinates(i);this.isColliding&&(e.fillStyle="grey",e.fillRect(r.x-s.x,r.y-this.height,this.getRight(),this.height));const o=64,l=64;e.drawImage(this.sprite,o,2*l,o-o/4,l-2,r.x-s.x,r.y-this.height+s.y,this.width,this.height)});n(this,"update",()=>null);n(this,"getTop",()=>this.height);n(this,"getBottom",()=>0);n(this,"getLeft",()=>0);n(this,"getRight",()=>this.width);this.sprite=s,this.width=64,this.height=64}}class de extends at{constructor(e,i,s){super(e,new C);n(this,"width");n(this,"height");n(this,"textures");n(this,"draw",(e,i,s)=>{const r=this.vCoordinates.getViewCoordinates(i);let o=this.height,l=0;for(;o>0;){let h=this.width,v=0;for(;h>0;)e.drawImage(l===0?this.textures.head:this.textures.body,0,0,Math.min(128,h),Math.min(128,o),128*v+r.x-this.width/2,128*l+r.y-this.height+s.y,Math.min(128,h),Math.min(128,o)),h-=128,v++;o-=128,l++}});this.width=i.width,this.height=i.height,this.textures=s}}class ge extends at{constructor(e,i,s){super(e,new C);n(this,"width");n(this,"height");n(this,"texture");n(this,"draw",e=>{e.drawImage(this.texture,0,0,1920,1080,0,0,this.width,this.height);const i=e.createLinearGradient(0,100,0,0);i.addColorStop(0,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=i,e.fillRect(0,this.height,this.width,-100),this.drawText(e),this.drawHelper(e)});n(this,"drawText",e=>{e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.textBaseline="bottom",e.fillText("\u041D\u0443\u0436\u043D\u043E \u043F\u043E\u043C\u043E\u0447\u044C \u0434\u0435\u0434\u0443 \u043C\u043E\u0440\u043E\u0437\u0443! \u041F\u043E\u0433\u043D\u0430\u043B\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u044F\u0442\u044C \u043A\u0432\u0435\u0441\u0442 :D",this.width/2,this.height-50)});n(this,"drawHelper",e=>{e.fillStyle="#ddd",e.font="15px Arial",e.textAlign="right",e.textBaseline="bottom",e.fillText("\u0414\u043B\u044F \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0435\u043D\u0438\u044F \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043F\u0440\u043E\u0431\u0435\u043B",this.width-10,this.height-10)});this.width=i.width,this.height=i.height,this.texture=s}}class ue{constructor(){n(this,"assets",{});n(this,"get",async(t,e="png")=>this.assets[t]||await this.loadAsset(t,e));n(this,"loadAssets",async t=>{const e=await Promise.all(t.map(i=>this.loadAsset(i)));t.map((i,s)=>this.assets[i]=e[s])});n(this,"loadAsset",(t,e="png")=>new Promise(i=>{const s=new Image;s.src=`/new-year-game/assets/${t}.${e}`,s.onload=()=>i(s)}))}}class fe{constructor(t,e){n(this,"context");n(this,"viewPortSize");n(this,"gameDriver");n(this,"assetManager");n(this,"playerRespawn",new C(250,250));n(this,"currentSantaSpawn",0);n(this,"santaSpawnPositions",[new C(2400,350),new C(3800,200),new C(5100,200)]);n(this,"gameState",{isGameOver:!1,level:1});n(this,"gameStart",async()=>(this.gameDriver.backgroundImage=await this.assetManager.get("background","jpg"),await this.spawnPlayer(),this.addSantaMeetingEventListener(),this.addGameOverEventListener(),this.gameDriver.start(),this.gameState));n(this,"loadMap",()=>Promise.all([Promise.all(Rt.characters.map(({position:t})=>this.spawnSanta(t))),Promise.all(Rt.platforms.map(({id:t,type:e,position:i,behavior:s,size:r})=>e==="static"?this.spawnPlatform(t,i,r):this.spawnMovingPlatform(t,i,s,r))),this.spawnWater()]));n(this,"spawnPlayer",async()=>{let t=[];this.gameState.player&&(t=[...this.gameState.player.eventListeners],this.gameDriver.despawnObject(this.gameState.player)),this.gameState.player=new le(this.playerRespawn.getCopy(),await this.assetManager.get("characters/player")),this.gameState.player.eventListeners=t,this.gameDriver.spawnObject(this.gameState.player)});n(this,"spawnSanta",async t=>(this.gameState.santa&&this.gameDriver.despawnObject(this.gameState.santa),this.gameState.santa=new ce(new C(t.x,t.y),new C,await this.assetManager.get("characters/santa")),this.gameDriver.spawnObject(this.gameState.santa),this.gameState.santa));n(this,"spawnWater",async()=>{const[t,e]=await Promise.all([this.assetManager.get("water/head"),this.assetManager.get("water/body")]),i=new de(new C(0,-400),{width:2*this.viewPortSize.width,height:400},{head:t,body:e});return this.gameDriver.spawnObject(i),i});n(this,"spawnOverlay",async()=>{this.gameState.overlay=this.gameDriver.overlay=new ge(new C(0,0),this.viewPortSize,await this.assetManager.get("dialog-overlay","jpg"))});n(this,"spawnPlatform",async(t,e,i)=>{const[s,r]=await Promise.all([this.assetManager.get(`platforms/${t}/head`),this.assetManager.get(`platforms/${t}/body`)]),o=new pt(e?new C().setByCoordsObject(e):new C,i||{width:0,height:0},{head:s,body:r});return this.gameDriver.spawnObject(o),o});n(this,"spawnMovingPlatform",async(t,e,i,s)=>{const[r,o]=await Promise.all([this.assetManager.get(`platforms/${t}/head`),this.assetManager.get(`platforms/${t}/body`)]),l=new Ft(e?new C().setByCoordsObject(e):new C,i?{...i,vTarget:new C().setByCoordsObject(i.target)}:{vTarget:new C,duration:1,repeat:"none"},s||{width:0,height:0},{head:r,body:o});return this.gameDriver.spawnObject(l),l});n(this,"addGameOverEventListener",()=>{this.gameState.player&&this.gameState.player.addEventListener(new te("less","y",0,!1,this.spawnPlayer))});n(this,"addSantaMeetingEventListener",()=>{this.gameState.player&&this.gameState.santa&&this.gameState.player.addEventListener(new jt(this.gameState.santa,!0,this.spawnOverlay))});n(this,"startMiniGame",()=>{this.gameState.santa&&this.gameState.player&&this.gameDriver.overlay&&(delete this.gameState.overlay,this.gameDriver.overlay=null,this.playerRespawn=this.gameState.santa.vCoordinates.getCopy(),this.currentSantaSpawn<3&&(this.gameState.santa.vCoordinates=this.santaSpawnPositions[this.currentSantaSpawn++].getCopy(),this.addSantaMeetingEventListener()),this.startMinigameCallback())});n(this,"startMinigameCallback",()=>{});this.context=t,this.viewPortSize=e,this.gameDriver=new ne(t,e),this.assetManager=new ue}}function ve(a){let t;return{c(){t=I("canvas"),this.h()},l(e){t=P(e,"CANVAS",{width:!0,height:!0,id:!0}),V(t).forEach(R),this.h()},h(){b(t,"width","271"),b(t,"height","392"),b(t,"id","game")},m(e,i){$(e,t,i),a[1](t)},p:U,i:U,o:U,d(e){e&&R(t),a[1](null)}}}const M=32,Lt=1,A=4;function q(a){return a*Math.PI/180}function Y(a,t,e){let i=Math.sin(e),s=Math.cos(e);return{x:a*s-t*i,y:a*i+t*s}}function me(a,t){return a=Math.ceil(a),t=Math.floor(t),Math.floor(Math.random()*(t-a+1))+a}function zt(a,t){const e=a.x-t.x,i=a.y-t.y;return Math.sqrt(e*e+i*i)}function kt(a,t){return zt(a,t)<a.radius+t.radius}function pe(a,t,e){var z;const i=ft();let s,r;const o=[["R","R","Y","Y","B","B","G","G"],["R","R","Y","Y","B","B","G"],["B","B","G","G","R","R","Y","Y"],["B","G","G","R","R","Y","Y"]],l={R:"red",G:"green",B:"blue",Y:"yellow"};Object.values(l);const h=[];let v=[];function g(c,E=!1){const f=h.filter(x=>x.active==E&&kt(c,x));if(!!f.length)return f.map(x=>({distance:zt(c,x),bubble:x})).sort((x,O)=>x.distance-O.distance)[0].bubble}function w(c,E,f){const x=Math.floor(E/M),O=Math.floor(c/M),ht=x%2===0?0:.5*M,N=M/2;h.push({x:A+(M+Lt)*O+ht+N,y:A+(M+Lt-4)*x+N,radius:M/2,color:f,active:!!f})}function S(c){const E=[],f=[Y(M,0,0),Y(M,0,q(60)),Y(M,0,q(120)),Y(M,0,q(180)),Y(M,0,q(240)),Y(M,0,q(300))];for(let x=0;x<f.length;x++){const O=f[x],ht={x:c.x+O.x,y:c.y+O.y,radius:c.radius},N=g(ht,!0);N&&N!==c&&!E.includes(N)&&E.push(N)}return E}function _(c){const E=[c];h.forEach(x=>x.processed=!1),c.processed=!0;let f=S(c);for(let x=0;x<f.length;x++){let O=f[x];O.processed||(O.processed=!0,O.color===c.color&&(E.push(O),f=f.concat(S(O))))}E.length>=3&&E.forEach(x=>{x.active=!1})}function y(){const c=h.filter(f=>f.active);c.forEach(f=>f.processed=!1);let E=c.filter(f=>f.y-M<=A);for(let f=0;f<E.length;f++){let x=E[f];x.processed||(x.processed=!0,E=E.concat(S(x)))}c.filter(f=>!f.processed).forEach(f=>{f.active=!1,v.push({x:f.x,y:f.y,color:f.color,radius:f.radius,active:!0})})}for(let c=0;c<10;c++)for(let E=0;E<(c%2===0?8:7);E++){const f=(z=o[c])==null?void 0:z[E];w(E*M,c*M,l[f])}let L,m,B=0;const p=q(-60),H=q(60);let G=0;function nt(){m.x=L.x,m.y=L.y,m.dx=m.dy=0;const c=h.filter(f=>f.active).map(({color:f})=>f).reduce((f,x)=>f.includes(x)?f:[...f,x],[]),E=me(0,c.length-1);m.color=c[E],c.length===0&&i("done")}function rt(c){c.color=m.color,c.active=!0,_(c),y(),nt()}let j;vt(()=>{if(!s)return;const c=s.getContext("2d");c&&(r=c),L={x:s.width/2,y:s.height-M*1.5},m={x:L.x,y:L.y,color:"red",radius:M/2,speed:8,dx:0,dy:0},window.addEventListener("keydown",u),window.addEventListener("keyup",D),j=requestAnimationFrame(d)}),It(()=>cancelAnimationFrame(j));function d(){if(j=requestAnimationFrame(d),r.clearRect(0,0,s.width,s.height),B=B+q(2)*G,B<p?B=p:B>H&&(B=H),m.x+=m.dx,m.y+=m.dy,m.x-M/2<A?(m.x=A+M/2,m.dx*=-1):m.x+M/2>s.width-A&&(m.x=s.width-A-M/2,m.dx*=-1),m.y-M/2<A){const c=g(m);rt(c)}for(let c=0;c<h.length;c++){const E=h[c];if(E.active&&kt(m,E)){const f=g(m);f||(window.alert("Game Over"),window.location.reload()),f&&rt(f)}}v.forEach(c=>{c.y+=8}),v=v.filter(c=>c.y<s.height-M/2),r.fillStyle="lightgrey",r.fillRect(0,0,s.width,A),r.fillRect(0,0,A,s.height),r.fillRect(s.width-A,0,A,s.height),h.concat(v).forEach(c=>{!c.active||(r.fillStyle=c.color,r.beginPath(),r.arc(c.x,c.y,c.radius,0,2*Math.PI),r.fill())}),r.save(),r.translate(L.x,L.y),r.rotate(B),r.translate(0,-M/2*4.5),r.strokeStyle="white",r.lineWidth=2,r.beginPath(),r.moveTo(0,0),r.lineTo(0,M*2),r.moveTo(0,0),r.lineTo(-10,M*.4),r.moveTo(0,0),r.lineTo(10,M*.4),r.stroke(),r.restore(),r.fillStyle=m.color,r.beginPath(),r.arc(m.x,m.y,m.radius,0,2*Math.PI),r.fill()}const u=c=>{c.code==="ArrowLeft"?G=-1:c.code==="ArrowRight"&&(G=1),c.code==="Space"&&m.dx===0&&m.dy===0&&(m.dx=Math.sin(B)*m.speed,m.dy=-Math.cos(B)*m.speed)},D=c=>{(c.code==="ArrowLeft"&&G===-1||c.code==="ArrowRight"&&G===1)&&(G=0)};function F(c){mt[c?"unshift":"push"](()=>{s=c,e(0,s)})}return[s,F]}class ye extends et{constructor(t){super(),it(this,t,pe,ve,st,{})}}function we(a){let t,e,i,s,r,o;return{c(){t=I("div"),e=I("canvas"),i=K(`\r
  Score: `),s=K(a[1]),r=K("/"),o=K(a[0]),this.h()},l(l){t=P(l,"DIV",{});var h=V(t);e=P(h,"CANVAS",{width:!0,height:!0,id:!0,class:!0}),V(e).forEach(R),i=W(h,`\r
  Score: `),s=W(h,a[1]),r=W(h,"/"),o=W(h,a[0]),h.forEach(R),this.h()},h(){b(e,"width","320"),b(e,"height","640"),b(e,"id","game"),b(e,"class","svelte-ny48w9")},m(l,h){$(l,t,h),T(t,e),a[3](e),T(t,i),T(t,s),T(t,r),T(t,o)},p(l,[h]){h&2&&wt(s,l[1]),h&1&&wt(o,l[0])},i:U,o:U,d(l){l&&R(t),a[3](null)}}}const J=32;function xe(a,t){return a=Math.ceil(a),t=Math.floor(t),Math.floor(Math.random()*(t-a+1))+a}function Ce(a){const t=a.length-1;return a.map((i,s)=>i.map((r,o)=>a[t-o][s]))}function Se(a,t,e){const i=ft();let{target:s=10}=t,r=0;function o(){const d=["I","J","L","O","S","T","Z"];for(;d.length;){const u=xe(0,d.length-1),D=d.splice(u,1)[0];_.push(D)}}function l(){_.length===0&&o();const d=_.pop(),u=L[d],D=y[0].length/2-Math.ceil(u[0].length/2);return{name:d,matrix:u,row:d==="I"?-1:-2,col:D}}function h(d,u,D){for(let F=0;F<d.length;F++)for(let z=0;z<d[F].length;z++)if(d[F][z]&&(D+z<0||D+z>=y[0].length||u+F>=y.length||y[u+F][D+z]))return!1;return!0}function v(){for(let d=0;d<p.matrix.length;d++)for(let u=0;u<p.matrix[d].length;u++)if(p.matrix[d][u]){if(p.row+d<0)return g();y[p.row+d][p.col+u]=p.name}for(let d=y.length-1;d>=0;)if(y[d].every(u=>!!u)){for(let u=d;u>=0;u--)for(let D=0;D<y[u].length;D++)y[u][D]=y[u-1][D];e(1,r++,r),r>=s&&i("done")}else d--;p=l()}function g(){cancelAnimationFrame(H),G=!0,S.fillStyle="black",S.globalAlpha=.75,S.fillRect(0,w.height/2-30,w.width,60),S.globalAlpha=1,S.fillStyle="white",S.font="36px monospace",S.textAlign="center",S.textBaseline="middle",S.fillText("GAME OVER!",w.width/2,w.height/2)}let w,S;const _=[],y=[];for(let d=-2;d<20;d++){y[d]=[];for(let u=0;u<10;u++)y[d][u]=0}const L={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]]},m={I:"cyan",O:"yellow",T:"purple",S:"green",Z:"red",J:"blue",L:"orange"};let B=0,p=l(),H=null,G=!1;vt(()=>{if(!w)return;const d=w.getContext("2d");d&&(S=d),H=requestAnimationFrame(nt),window.addEventListener("keydown",rt)}),It(()=>cancelAnimationFrame(H));function nt(){H=requestAnimationFrame(nt),S.clearRect(0,0,w.width,w.height);for(let d=0;d<20;d++)for(let u=0;u<10;u++)if(y[d][u]){const D=y[d][u];S.fillStyle=m[D],S.fillRect(u*J,d*J,J-1,J-1)}if(p){++B>35&&(p.row++,B=0,h(p.matrix,p.row,p.col)||(p.row--,v())),S.fillStyle=m[p.name];for(let d=0;d<p.matrix.length;d++)for(let u=0;u<p.matrix[d].length;u++)p.matrix[d][u]&&S.fillRect((p.col+u)*J,(p.row+d)*J,J-1,J-1)}}const rt=d=>{if(!G){if(d.which===37||d.which===39){const u=d.which===37?p.col-1:p.col+1;h(p.matrix,p.row,u)&&(p.col=u)}if(d.which===38){const u=Ce(p.matrix);h(u,p.row,p.col)&&(p.matrix=u)}if(d.which===40){const u=p.row+1;if(!h(p.matrix,u,p.col)){p.row=u-1,v();return}p.row=u}}};function j(d){mt[d?"unshift":"push"](()=>{w=d,e(2,w)})}return a.$$set=d=>{"target"in d&&e(0,s=d.target)},[s,r,w,j]}class Me extends et{constructor(t){super(),it(this,t,Se,we,st,{target:0})}}function Dt(a){let t,e;return{c(){t=I("h1"),e=K("\u0412\u044B \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438! \u0421 \u041D\u043E\u0432\u044B\u043C \u0413\u043E\u0434\u043E\u043C!")},l(i){t=P(i,"H1",{});var s=V(t);e=W(s,"\u0412\u044B \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438! \u0421 \u041D\u043E\u0432\u044B\u043C \u0413\u043E\u0434\u043E\u043C!"),s.forEach(R)},m(i,s){$(i,t,s),T(t,e)},d(i){i&&R(t)}}}function Tt(a){let t,e,i,s,r,o,l;var h=a[4][a[3]];function v(g){return{}}return h&&(t=Ct(h,v()),t.$on("done",a[5])),{c(){t&&dt(t.$$.fragment),e=X(),i=I("button"),s=K("Skip minigame")},l(g){t&&At(t.$$.fragment,g),e=Q(g),i=P(g,"BUTTON",{});var w=V(i);s=W(w,"Skip minigame"),w.forEach(R)},m(g,w){t&&gt(t,g,w),$(g,e,w),$(g,i,w),T(i,s),r=!0,o||(l=Bt(i,"click",a[5]),o=!0)},p(g,w){if(h!==(h=g[4][g[3]])){if(t){Pt();const S=t;tt(S.$$.fragment,1,0,()=>{ut(S,1)}),Ot()}h?(t=Ct(h,v()),t.$on("done",g[5]),dt(t.$$.fragment),Z(t.$$.fragment,1),gt(t,e.parentNode,e)):t=null}},i(g){r||(t&&Z(t.$$.fragment,g),r=!0)},o(g){t&&tt(t.$$.fragment,g),r=!1},d(g){t&&ut(t,g),g&&R(e),g&&R(i),o=!1,l()}}}function _e(a){let t,e,i,s,r,o,l=a[2]&&Dt(),h=!a[2]&&a[1]&&Tt(a);return{c(){t=I("div"),l&&l.c(),e=X(),h&&h.c(),i=X(),s=I("canvas"),r=K("Your browser does not support the HTML5 canvas tag."),this.h()},l(v){t=P(v,"DIV",{class:!0});var g=V(t);l&&l.l(g),e=Q(g),h&&h.l(g),i=Q(g),s=P(g,"CANVAS",{width:!0,height:!0,class:!0});var w=V(s);r=W(w,"Your browser does not support the HTML5 canvas tag."),w.forEach(R),g.forEach(R),this.h()},h(){b(s,"width",1024),b(s,"height",512),b(s,"class","svelte-1rfllgf"),xt(s,"display",a[1]||a[2]?"none":"block"),b(t,"class","container")},m(v,g){$(v,t,g),l&&l.m(t,null),T(t,e),h&&h.m(t,null),T(t,i),T(t,s),T(s,r),a[6](s),o=!0},p(v,[g]){v[2]?l||(l=Dt(),l.c(),l.m(t,e)):l&&(l.d(1),l=null),!v[2]&&v[1]?h?(h.p(v,g),g&6&&Z(h,1)):(h=Tt(v),h.c(),Z(h,1),h.m(t,i)):h&&(Pt(),tt(h,1,1,()=>{h=null}),Ot()),g&6&&xt(s,"display",v[1]||v[2]?"none":"block")},i(v){o||(Z(h),o=!0)},o(v){tt(h),o=!1},d(v){v&&R(t),l&&l.d(),h&&h.d(),a[6](null)}}}function Ee(a,t,e){let i,s,r=!1,o=!1;const l=[ye,Wt,Me];let h=0;vt(async()=>{const _=s.getContext("2d");if(_){const y=s.getBoundingClientRect();i=new fe(_,{width:y.width,height:y.height}),await i.loadMap(),i.gameStart(),i.startMinigameCallback=()=>{h<l.length?(e(1,r=!0),i.gameState.player&&(i.gameState.player.stopJumping(),i.gameState.player.stopMoveRight(),i.gameState.player.stopMoveLeft())):e(2,o=!0)},window.addEventListener("keydown",g),window.addEventListener("keyup",w)}});function v(){e(1,r=!1),e(3,h++,h)}function g(_){if(i.gameState&&i.gameState.player&&!r)switch(_.code){case"KeyW":i.gameState.player.startJumping();break;case"KeyD":i.gameState.player.startMoveRight();break;case"KeyA":i.gameState.player.startMoveLeft();break;case"Space":i.startMiniGame();break}}function w(_){if(i.gameState&&i.gameState.player&&!r)switch(_.code){case"KeyW":i.gameState.player.stopJumping();break;case"KeyD":i.gameState.player.stopMoveRight();break;case"KeyA":i.gameState.player.stopMoveLeft();break}}function S(_){mt[_?"unshift":"push"](()=>{s=_,e(0,s)})}return[s,r,o,h,l,v,S]}class be extends et{constructor(t){super(),it(this,t,Ee,_e,st,{})}}function Re(a){let t,e,i,s,r;return s=new be({}),{c(){t=I("meta"),e=X(),i=I("section"),dt(s.$$.fragment),this.h()},l(o){const l=Ht("svelte-t32ptj",document.head);t=P(l,"META",{name:!0,content:!0}),l.forEach(R),e=Q(o),i=P(o,"SECTION",{class:!0});var h=V(i);At(s.$$.fragment,h),h.forEach(R),this.h()},h(){document.title="Home",b(t,"name","description"),b(t,"content","Svelte demo app"),b(i,"class","svelte-iwe87e")},m(o,l){T(document.head,t),$(o,e,l),$(o,i,l),gt(s,i,null),r=!0},p:U,i(o){r||(Z(s.$$.fragment,o),r=!0)},o(o){tt(s.$$.fragment,o),r=!1},d(o){R(t),o&&R(e),o&&R(i),ut(s)}}}class De extends et{constructor(t){super(),it(this,t,null,Re,st,{})}}export{De as default};
