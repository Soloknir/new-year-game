var mt=Object.defineProperty;var pt=(n,t,e)=>t in n?mt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var i=(n,t,e)=>(pt(n,typeof t!="symbol"?t+"":t,e),e);import{S as H,i as K,s as N,k as x,l as b,m as _,h as v,n as d,b as S,B as V,I as vt,J as wt,a as I,c as P,K as O,L as J,D as y,M as ft,q as yt,r as xt,p as Y,f as C,g as ot,t as k,d as rt,o as bt,v as X,w as G,e as Z,x as ht,y as $,z as q,N as Mt,O as Ct}from"../../chunks/index-5038dfa0.js";let R;const St=new Uint8Array(16);function Bt(){if(!R&&(R=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!R))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return R(St)}const m=[];for(let n=0;n<256;++n)m.push((n+256).toString(16).slice(1));function Lt(n,t=0){return(m[n[t+0]]+m[n[t+1]]+m[n[t+2]]+m[n[t+3]]+"-"+m[n[t+4]]+m[n[t+5]]+"-"+m[n[t+6]]+m[n[t+7]]+"-"+m[n[t+8]]+m[n[t+9]]+"-"+m[n[t+10]]+m[n[t+11]]+m[n[t+12]]+m[n[t+13]]+m[n[t+14]]+m[n[t+15]]).toLowerCase()}const _t=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Q={randomUUID:_t};function U(n,t,e){if(Q.randomUUID&&!t&&!n)return Q.randomUUID();n=n||{};const s=n.random||(n.rng||Bt)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){e=e||0;for(let a=0;a<16;++a)t[e+a]=s[a];return t}return Lt(s)}class lt{constructor(t,e){i(this,"type","");i(this,"id");i(this,"once");i(this,"callback");i(this,"check",t=>!1);this.id=U(),this.once=t,this.callback=e}}class kt extends lt{constructor(e,s,a){super(s,a);i(this,"type","collision");i(this,"object");i(this,"check",e=>ct(e,this.object));this.object=e}}class Et extends lt{constructor(e,s,a,r,o){super(r,o);i(this,"type","edge");i(this,"sign");i(this,"axis");i(this,"value");i(this,"check",e=>this.axis==="x"?this.sign==="gather"?e.vCoordinates.x+e.getLeft()>this.value:e.vCoordinates.x+e.getRight()<this.value:this.sign==="gather"?e.vCoordinates.y+e.getBottom()>this.value:e.vCoordinates.y+e.getTop()<this.value);this.sign=e,this.axis=s,this.value=a}}class B{constructor(t,e){i(this,"id");i(this,"vCoordinates");i(this,"vVelocity");i(this,"eventListeners",[]);i(this,"draw",(t,e,s)=>{});i(this,"update",(t,e)=>this.checkEventListeners());i(this,"checkEventListeners",()=>{});i(this,"addEventListener",t=>this.eventListeners.push(t));i(this,"removeEventListener",t=>{const e=this.eventListeners.findIndex(({id:s})=>s===t);e>-1&&this.eventListeners.splice(e,1)});this.id=U(),this.vCoordinates=t,this.vVelocity=e}}const z=n=>"width"in n&&"height"in n,j=n=>"radius"in n,At=n=>"isColliding"in n,Rt=n=>"mass"in n,Dt=(n,t)=>!(t.vCoordinates.x>n.width+n.vCoordinates.x||n.vCoordinates.x>t.width+t.vCoordinates.x||t.vCoordinates.y>n.height+n.vCoordinates.y||n.vCoordinates.y>t.height+t.vCoordinates.y),tt=(n,t)=>{const e=t.vCoordinates.getCopy(),{width:s,height:a}=n;return e.x=t.vCoordinates.x<n.vCoordinates.x?n.vCoordinates.x:t.vCoordinates.x>n.vCoordinates.x+s?n.vCoordinates.x+s:e.x,e.y=t.vCoordinates.y<n.vCoordinates.y?n.vCoordinates.y:t.vCoordinates.y>n.vCoordinates.y+a?n.vCoordinates.y+a:e.y,t.vCoordinates.getDistance(e)<=t.radius},It=(n,t)=>n.vCoordinates.getDistance(t.vCoordinates)<=n.radius+t.radius,ct=(n,t)=>{if(j(n)){if(j(t))return It(n,t);if(z(t))return tt(t,n)}return z(n)?z(t)?Dt(n,t):tt(n,t):!1};class c{constructor(t=0,e=0){i(this,"x");i(this,"y");i(this,"getCopy",()=>new c(this.x,this.y));i(this,"getCoordsObject",()=>({x:this.x,y:this.y}));i(this,"setByCoordsObject",({x:t,y:e})=>(this.x=t,this.y=e,this));i(this,"ceil",()=>(this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this));i(this,"divByNumber",t=>new c(this.x/t,this.y/t));i(this,"getDifference",({x:t,y:e})=>new c(this.x-t,this.y-e));i(this,"getDistance",({x:t,y:e})=>{const s=this.x-t,a=this.y-e;return Math.sqrt(s*s+a*a)});this.x=t,this.y=e}getViewCoordinates(t){return new c(this.x,t-this.y)}}class W extends B{constructor(e,s,a){super(e,new c);i(this,"width");i(this,"height");i(this,"textures");i(this,"draw",(e,s,a)=>{const r=this.vCoordinates.getViewCoordinates(s);let o=this.height,h=0;for(;o>0;){let l=this.width,u=0;for(;l>0;)e.drawImage(h===0?this.textures.head:this.textures.body,0,0,Math.min(128,l),Math.min(128,o),128*u+r.x-a.x,128*h+r.y-this.height+a.y,Math.min(128,l),Math.min(128,o)),l-=128,u++;o-=128,h++}});i(this,"getTop",()=>this.height);i(this,"getBottom",()=>0);i(this,"getLeft",()=>0);i(this,"getRight",()=>this.width);this.width=s.width,this.height=s.height,this.textures=a}}class dt extends W{constructor(e,s,a,r){super(e,a,r);i(this,"vSpawn");i(this,"lastDistance");i(this,"behavior");i(this,"update",e=>{this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e;const s=this.behavior.vTarget.getDistance(this.vCoordinates);this.lastDistance<s?this.getMoveEndStrategy():this.lastDistance=s});i(this,"getVelocity",()=>{const e=this.behavior.vTarget.getDifference(this.vCoordinates);return e.x===0||e.y===0?e.x!==0?new c(e.x/this.behavior.duration,0):e.y!==0?new c(0,e.y/this.behavior.duration):new c:e.divByNumber(this.behavior.duration)});i(this,"getMoveEndStrategy",()=>{switch(this.behavior.repeat){case"fromStart":{this.vCoordinates=this.vSpawn.getCopy(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}case"fromEnd":{const e=this.vSpawn.getCopy();this.vSpawn=this.behavior.vTarget.getCopy(),this.behavior.vTarget=e,this.vCoordinates=this.vSpawn.getCopy(),this.vVelocity=this.getVelocity(),this.lastDistance=this.behavior.vTarget.getDistance(this.vSpawn);return}default:this.vVelocity=new c}});if(this.vSpawn=e.getCopy(),this.behavior=s,this.lastDistance=s.vTarget.getDistance(this.vSpawn),this.vVelocity=this.getVelocity(),this.behavior.shift){const o=this.behavior.vTarget.getDifference(this.vCoordinates);this.vCoordinates.x+=this.behavior.shift*o.x,this.vCoordinates.x+=this.behavior.shift*o.y}}}class Pt{constructor(t,e){i(this,"context");i(this,"rAF",null);i(this,"vViewCoordinates",new c);i(this,"viewPortWidth");i(this,"viewPortHeight");i(this,"gameObjects",[]);i(this,"overlay",null);i(this,"backgroundImage",null);i(this,"time",0);i(this,"secondsPassed",0);i(this,"oldTimeStamp",0);i(this,"start",()=>this.rAF=window.requestAnimationFrame(this.loop));i(this,"pause",()=>this.rAF&&window.cancelAnimationFrame(this.rAF));i(this,"loop",t=>{this.rAF=requestAnimationFrame(this.loop),this.overlay?this.overlay.draw(this.context):(this.secondsPassed=(t-this.oldTimeStamp)/1e3,this.time+=this.secondsPassed,this.oldTimeStamp=t,this.gameObjects.forEach(e=>e.update(Math.min(this.secondsPassed,.1),this.vViewCoordinates)),this.detectPlatformCollision(),this.backgroundImage&&this.context.drawImage(this.backgroundImage,0,0,this.viewPortWidth,this.viewPortHeight),this.gameObjects.forEach(e=>e.draw(this.context,this.viewPortHeight,this.vViewCoordinates)),this.drawFps(Math.round(1/this.secondsPassed)))});i(this,"drawFps",t=>{this.context.fillStyle="#fff",this.context.font="20px Arial",this.context.textAlign="right",this.context.textBaseline="bottom",this.context.fillText(`fps: ${t}`,this.viewPortWidth-20,30)});i(this,"detectPlatformCollision",()=>{const t=this.gameObjects.filter(s=>s instanceof W||s instanceof dt),e=this.gameObjects.filter(s=>At(s)&&Rt(s));t.forEach(s=>{e.forEach(a=>{ct(s,a)&&(a.vCoordinates.y+a.getBottom()>s.vCoordinates.y+s.getBottom()&&a.vCoordinates.y+a.getTop()>s.vCoordinates.y+s.getTop()&&a.vCoordinates.x+a.getRight()>s.vCoordinates.x+s.getLeft()&&a.vCoordinates.x+a.getLeft()<s.vCoordinates.x+s.getRight()&&(a.vCoordinates.y=s.vCoordinates.y+s.getTop()-a.getBottom(),a.vVelocity.x=a.vVelocity.x*(1-a.friction),a.vVelocity.y=1,a.platform=s),a.vCoordinates.y+a.getTop()<s.vCoordinates.y+s.getTop()&&a.vCoordinates.y+a.getBottom()<s.vCoordinates.y+s.getBottom()&&a.vCoordinates.x+a.getRight()>s.vCoordinates.x+s.getLeft()&&a.vCoordinates.x+a.getLeft()<s.vCoordinates.x+s.getRight()&&(a.vCoordinates.y=s.vCoordinates.y-a.getTop(),a.vVelocity.y=-1),a.vCoordinates.x+a.getLeft()<s.vCoordinates.x+s.getLeft()&&a.vCoordinates.x+a.getRight()>s.vCoordinates.x+s.getLeft()&&a.vCoordinates.y+a.getTop()<s.vCoordinates.y+s.getTop()&&a.vCoordinates.y+a.getBottom()>=s.vCoordinates.y+s.getBottom()&&(a.vCoordinates.x=s.vCoordinates.x-a.getRight(),a.vVelocity.x=-1),a.vCoordinates.x+a.getLeft()<s.vCoordinates.x+s.getRight()&&a.vCoordinates.x+a.getRight()>s.vCoordinates.x+s.getRight()&&a.vCoordinates.y+a.getTop()<s.vCoordinates.y+s.getTop()&&a.vCoordinates.y+a.getBottom()>=s.vCoordinates.y+s.getBottom()&&(a.vCoordinates.x=s.vCoordinates.x+s.getRight(),a.vVelocity.x=1))})})});i(this,"spawnObject",t=>this.gameObjects.push(t));i(this,"despawnObject",t=>this.gameObjects=this.gameObjects.filter(({id:e})=>t.id!==e));i(this,"worldReset",()=>this.vViewCoordinates=new c);this.context=t,this.viewPortWidth=e.width,this.viewPortHeight=e.height}}const Tt=[{id:"santa",position:{x:1e3,y:300}}],Ft=[{id:"base",type:"static",position:{x:0,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:500,y:-200},size:{width:300,height:400}},{id:"base",type:"static",position:{x:900,y:-200},size:{width:300,height:500}},{id:"base",type:"static",position:{x:900,y:400},size:{width:300,height:250}},{id:"base",type:"static",position:{x:1500,y:-200},size:{width:100,height:525}},{id:"base",type:"static",position:{x:2e3,y:-200},size:{width:100,height:425}},{id:"base",type:"static",position:{x:2300,y:-200},size:{width:250,height:550}},{id:"base",type:"dynamic",position:{x:2600,y:200},size:{width:100,height:20},behavior:{target:{x:3e3,y:200},duation:10,repeat:"fromEnd",duration:10}},{id:"base",type:"dynamic",position:{x:3100,y:300},size:{width:100,height:20},behavior:{target:{x:3500,y:300},duation:10,repeat:"fromEnd",duration:10,shift:1}},{id:"base",type:"static",position:{x:3800,y:100},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4200,y:200},size:{width:300,height:100}},{id:"base",type:"static",position:{x:4600,y:-200},size:{width:300,height:300}},{id:"base",type:"static",position:{x:5e3,y:-200},size:{width:200,height:400}}],Ot={characters:Tt,platforms:Ft},zt="/new-year-game",Vt=9.8;class Gt extends B{constructor(e,s){super(e,new c);i(this,"width");i(this,"height");i(this,"friction");i(this,"mass");i(this,"platform",null);i(this,"isColliding",!1);i(this,"sprite");i(this,"time",0);i(this,"column",0);i(this,"row",2);i(this,"horizontalMoveSpeed");i(this,"jumpImpulse");i(this,"isJumping",!1);i(this,"isMoveRight",!1);i(this,"isMoveLeft",!1);i(this,"draw",(e,s,a)=>{const r=this.vCoordinates.getViewCoordinates(s);this.isMoveRight?(this.column=Math.round(this.time*10%8),this.row=11):this.isMoveLeft?(this.column=Math.round(this.time*10%8),this.row=9):(this.row=2,this.column=0);const o=64,h=64;e.drawImage(this.sprite,this.column*o,this.row*h,o,h-2,r.x-a.x,r.y-this.height+a.y,this.width+o/4,this.height)});i(this,"update",(e,s)=>{this.checkEventListeners(),this.time+=e,this.vVelocity.y-=Vt*this.mass*e,this.vVelocity.x=0,this.isMoveRight&&(this.vVelocity.x+=this.horizontalMoveSpeed),this.isMoveLeft&&(this.vVelocity.x-=this.horizontalMoveSpeed),this.platform&&(this.vVelocity.x+=this.platform.vVelocity.x),this.isJumping&&this.platform&&(this.platform=null,this.vVelocity.y=this.jumpImpulse),this.vCoordinates.x+=this.vVelocity.x*e,this.vCoordinates.y+=this.vVelocity.y*e,s.x=this.vCoordinates.x-250,s.y=this.vCoordinates.y-250});i(this,"checkEventListeners",()=>{this.eventListeners.forEach(e=>{e.check(this)&&(e.once&&this.removeEventListener(e.id),e.callback())})});i(this,"getTop",()=>this.height);i(this,"getBottom",()=>0);i(this,"getLeft",()=>0);i(this,"getRight",()=>this.width-16);i(this,"startJumping",()=>this.isJumping=!0);i(this,"stopJumping",()=>this.isJumping=!1);i(this,"startMoveRight",()=>this.isMoveRight=!0);i(this,"stopMoveRight",()=>this.isMoveRight=!1);i(this,"startMoveLeft",()=>this.isMoveLeft=!0);i(this,"stopMoveLeft",()=>this.isMoveLeft=!1);this.sprite=s,this.width=64,this.height=64,this.friction=.1,this.mass=100,this.horizontalMoveSpeed=500,this.jumpImpulse=500}}class $t extends B{constructor(e,s,a){super(e,s);i(this,"width");i(this,"height");i(this,"isColliding",!1);i(this,"sprite");i(this,"draw",(e,s,a)=>{const r=this.vCoordinates.getViewCoordinates(s);this.isColliding&&(e.fillStyle="grey",e.fillRect(r.x-a.x,r.y-this.height,this.getRight(),this.height));const o=64,h=64;e.drawImage(this.sprite,o,2*h,o-o/4,h-2,r.x-a.x,r.y-this.height+a.y,this.width,this.height)});i(this,"update",()=>null);i(this,"getTop",()=>this.height);i(this,"getBottom",()=>0);i(this,"getLeft",()=>0);i(this,"getRight",()=>this.width);this.sprite=a,this.width=64,this.height=64}}class qt extends B{constructor(e,s,a){super(e,new c);i(this,"width");i(this,"height");i(this,"textures");i(this,"draw",(e,s,a)=>{const r=this.vCoordinates.getViewCoordinates(s);let o=this.height,h=0;for(;o>0;){let l=this.width,u=0;for(;l>0;)e.drawImage(h===0?this.textures.head:this.textures.body,0,0,Math.min(128,l),Math.min(128,o),128*u+r.x-this.width/2,128*h+r.y-this.height+a.y,Math.min(128,l),Math.min(128,o)),l-=128,u++;o-=128,h++}});this.width=s.width,this.height=s.height,this.textures=a}}class Ht extends B{constructor(e,s,a){super(e,new c);i(this,"width");i(this,"height");i(this,"texture");i(this,"draw",e=>{e.drawImage(this.texture,0,0,1920,1080,0,0,this.width,this.height);const s=e.createLinearGradient(0,100,0,0);s.addColorStop(0,"rgba(0, 0, 0, 0.5)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=s,e.fillRect(0,this.height,this.width,-100),this.drawText(e),this.drawHelper(e)});i(this,"drawText",e=>{e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.textBaseline="bottom",e.fillText("\u041D\u0443\u0436\u043D\u043E \u043F\u043E\u043C\u043E\u0447\u044C \u0434\u0435\u0434\u0443 \u043C\u043E\u0440\u043E\u0437\u0443! \u041F\u043E\u0433\u043D\u0430\u043B\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u044F\u0442\u044C \u043A\u0432\u0435\u0441\u0442 :D",this.width/2,this.height-50)});i(this,"drawHelper",e=>{e.fillStyle="#ddd",e.font="15px Arial",e.textAlign="right",e.textBaseline="bottom",e.fillText("\u0414\u043B\u044F \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0435\u043D\u0438\u044F \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043F\u0440\u043E\u0431\u0435\u043B",this.width-10,this.height-10)});this.width=s.width,this.height=s.height,this.texture=a}}class T{constructor(){i(this,"assets",{});i(this,"get",t=>this.assets[t]);i(this,"loadAssets",async t=>{const e=await Promise.all(t.map(({path:s,format:a})=>this.loadAsset(s,a)));t.map(({path:s},a)=>this.assets[s]=e[a])});i(this,"loadAsset",(t,e="png")=>new Promise(s=>{const a=new Image;a.src=`/new-year-game/assets/${t}.${e}`,a.onload=()=>s(a)}))}}class g{constructor(t,e){i(this,"id");i(this,"keys");i(this,"callback");this.id=U(),this.keys=t,this.callback=e}}class E{constructor(){i(this,"events",{});i(this,"getHandler",t=>e=>{var s;(s=this.events[t])==null||s.filter(({keys:a})=>a.includes(e.code)).map(({callback:a})=>a())});i(this,"addEventListener",(t,e)=>{this.events[t]?this.events[t].push(e):this.events[t]=[e]});i(this,"removeEventListener",t=>{Object.keys(this.events).forEach(e=>{this.events[e]=this.events[e].filter(({id:s})=>t.id!==s)})});window.addEventListener("keydown",this.getHandler("keydown")),window.addEventListener("keyup",this.getHandler("keyup"))}static get Instance(){return this._instance||(this._instance=new this)}}i(E,"_instance");class Kt{constructor(){i(this,"sounds",{});i(this,"get",t=>this.sounds[t]);i(this,"loadSounds",async t=>{const e=await Promise.all(t.map(({path:s,format:a})=>this.loadSound(s,a)));t.map(({path:s},a)=>this.sounds[s]=e[a])});i(this,"loadSound",(t,e="mp3")=>new Promise(s=>{const a=new Audio(`${zt}/assets/music/${t}.${e}`);a.preload="auto",a.controls=!1,a.loop=!0,a.volume=.05,a.onloadstart=()=>s(a)}))}}var D=(n=>(n.I="tetris/cube",n.O="tetris/cube-blue",n.T="tetris/cube-brown",n.S="tetris/cube-green",n.Z="tetris/cube-pink",n.J="tetris/cube-red",n.L="tetris/cube-violet",n))(D||{});class Nt{constructor(t,e,s){i(this,"context");i(this,"rAF",null);i(this,"grid",32);i(this,"tetrominoSequence",[]);i(this,"playfield",[]);i(this,"assetsManager");i(this,"controlsEvents",[]);i(this,"controlsManager");i(this,"count",0);i(this,"tetromino");i(this,"gameOver",!1);i(this,"target",10);i(this,"score",0);i(this,"size");i(this,"tetrominos",{I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]]});i(this,"endGameCallback");i(this,"init",async()=>{this.initControlsListeners(),this.startListeningControls();for(let t=-2;t<20;t++){this.playfield[t]=[];for(let e=0;e<10;e++)this.playfield[t][e]=null}await this.loadAssets(),this.rAF=requestAnimationFrame(this.loop)});i(this,"getRandomInt",(t,e)=>(t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t));i(this,"generateSequence",()=>{const t=["I","J","L","O","S","T","Z"];for(;t.length;){const e=this.getRandomInt(0,t.length-1),s=t.splice(e,1)[0];this.tetrominoSequence.push(s)}});i(this,"getNextTetromino",()=>{this.tetrominoSequence.length===0&&this.generateSequence();const t=this.tetrominoSequence.pop(),e=this.tetrominos[t],s=this.playfield[0].length/2-Math.ceil(e[0].length/2);return{name:t,matrix:e,row:t==="I"?-1:-2,col:s}});i(this,"rotate",t=>{const e=t.length-1;return t.map((a,r)=>a.map((o,h)=>t[e-h][r]))});i(this,"isValidMove",(t,e,s)=>{for(let a=0;a<t.length;a++)for(let r=0;r<t[a].length;r++)if(t[a][r]&&(s+r<0||s+r>=this.playfield[0].length||e+a>=this.playfield.length||this.playfield[e+a][s+r]))return!1;return!0});i(this,"placeTetromino",()=>{for(let t=0;t<this.tetromino.matrix.length;t++)for(let e=0;e<this.tetromino.matrix[t].length;e++)if(this.tetromino.matrix[t][e]){if(this.tetromino.row+t<0)return this.showGameOver();this.playfield[this.tetromino.row+t][this.tetromino.col+e]=this.tetromino.name}for(let t=this.playfield.length-1;t>=0;)if(this.playfield[t].every(e=>!!e)){for(let e=t;e>=0;e--)for(let s=0;s<this.playfield[e].length;s++)this.playfield[e][s]=this.playfield[e-1][s];this.score++,this.score>=this.target&&(this.endGameCallback(),this.rAF&&window.cancelAnimationFrame(this.rAF))}else t--;this.tetromino=this.getNextTetromino()});i(this,"loop",()=>{this.rAF=requestAnimationFrame(this.loop);const t=this.size.width/2-160;this.context.drawImage(this.assetsManager.get("background/bg-minigame"),0,0,this.size.width,this.size.height),this.context.fillStyle="lightgrey",this.context.fillRect(t,0,4,this.size.height),this.context.fillRect(t+320,0,4,this.size.height);for(let e=0;e<20;e++)for(let s=0;s<10;s++)if(this.playfield[e][s]){const a=this.playfield[e][s];a&&this.context.drawImage(this.assetsManager.get(D[a]),s*this.grid+t,e*this.grid,this.grid-1,this.grid-1)}if(this.tetromino){++this.count>35&&(this.tetromino.row++,this.count=0,this.isValidMove(this.tetromino.matrix,this.tetromino.row,this.tetromino.col)||(this.tetromino.row--,this.placeTetromino()));for(let e=0;e<this.tetromino.matrix.length;e++)for(let s=0;s<this.tetromino.matrix[e].length;s++)this.tetromino.matrix[e][s]&&this.context.drawImage(this.assetsManager.get(D[this.tetromino.name]),(this.tetromino.col+s)*this.grid+t,(this.tetromino.row+e)*this.grid,this.grid-1,this.grid-1)}});i(this,"release",()=>{this.rAF&&window.cancelAnimationFrame(this.rAF),this.stopListeningControls(),this.endGameCallback()});i(this,"loadAssets",async()=>await this.assetsManager.loadAssets([...Object.values(D).map(t=>({path:t,format:"png"})),{path:"background/bg-minigame",format:"jpg"}]));i(this,"initControlsListeners",()=>{this.controlsEvents=[{action:"keydown",event:new g(["ArrowUp","KeyW"],this.handleRotate)},{action:"keydown",event:new g(["ArrowRight","KeyD"],this.handleMoveRight)},{action:"keydown",event:new g(["ArrowLeft","KeyA"],this.handleMoveLeft)},{action:"keydown",event:new g(["ArrowDown","KeyS"],this.handleMoveDown)},{action:"keydown",event:new g(["Escape"],this.release)}]});i(this,"startListeningControls",()=>this.controlsEvents.map(({action:t,event:e})=>this.controlsManager.addEventListener(t,e)));i(this,"stopListeningControls",()=>this.controlsEvents.map(({event:t})=>this.controlsManager.removeEventListener(t)));i(this,"handleMoveLeft",()=>{const t=this.tetromino.col-1;this.isValidMove(this.tetromino.matrix,this.tetromino.row,t)&&(this.tetromino.col=t)});i(this,"handleMoveRight",()=>{const t=this.tetromino.col+1;this.isValidMove(this.tetromino.matrix,this.tetromino.row,t)&&(this.tetromino.col=t)});i(this,"handleRotate",()=>{const t=this.rotate(this.tetromino.matrix);this.isValidMove(t,this.tetromino.row,this.tetromino.col)&&(this.tetromino.matrix=t)});i(this,"handleMoveDown",()=>{const t=this.tetromino.row+1;if(!this.isValidMove(this.tetromino.matrix,t,this.tetromino.col)){this.tetromino.row=t-1,this.placeTetromino();return}this.tetromino.row=t});this.context=t,this.size=e,this.endGameCallback=s,this.assetsManager=new T,this.controlsManager=E.Instance,this.init(),this.tetromino=this.getNextTetromino()}showGameOver(){this.rAF&&cancelAnimationFrame(this.rAF),this.gameOver=!0,this.context.fillStyle="black",this.context.globalAlpha=.75,this.context.fillRect(0,this.size.height/2-30,this.size.width,60),this.context.globalAlpha=1,this.context.fillStyle="white",this.context.font="36px monospace",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("GAME OVER!",this.size.width/2,this.size.height/2)}}class et extends B{constructor(e,s,a){super(e,new c);i(this,"width");i(this,"height");i(this,"texture");i(this,"hover",!1);i(this,"draw",(e,s)=>{const a=this.vCoordinates.getViewCoordinates(s);this.hover&&(e.fillStyle="red",e.fillRect(a.x,a.y,this.width,this.height)),e.drawImage(this.texture,a.x,a.y,this.width,this.height)});i(this,"checkCursorColision",(e,s)=>{const a=e.getViewCoordinates(s);return a.x>this.vCoordinates.x&&a.x<this.vCoordinates.x+this.getRight()&&a.y<this.vCoordinates.y&&a.y>this.vCoordinates.y-this.getTop()});i(this,"getTop",()=>this.height);i(this,"getBottom",()=>0);i(this,"getLeft",()=>0);i(this,"getRight",()=>this.width);this.width=s.width,this.height=s.height,this.texture=a}}class Ut{constructor(t,e,s){i(this,"rAF",null);i(this,"context");i(this,"canvasBoundingRect");i(this,"closeHandler");i(this,"opened",!1);i(this,"assetsManager");i(this,"controlsManager");i(this,"controlsEvents",[]);i(this,"buttons",[]);i(this,"isAssetsLoaded",!1);i(this,"lastMousePosition",new c);i(this,"afterLoadCollback");i(this,"init",async()=>{this.initControlsListeners(),await this.loadAssets(),this.createButtons(),this.isAssetsLoaded=!0,this.afterLoadCollback&&this.afterLoadCollback()});i(this,"createButtons",()=>{this.buttons=[new et(new c(860,400),{width:150,height:50},this.assetsManager.get("controls/button-start")),new et(new c(860,325),{width:150,height:50},this.assetsManager.get("controls/button-control"))]});i(this,"open",()=>{this.opened||(this.isAssetsLoaded?(this.opened=!0,this.rAF=window.requestAnimationFrame(this.loop),this.startListeningControls()):this.afterLoadCollback=this.open)});i(this,"release",()=>{this.opened&&(this.opened=!1,this.rAF&&window.cancelAnimationFrame(this.rAF),this.stopListeningControls(),this.closeHandler())});i(this,"loop",()=>{this.rAF=window.requestAnimationFrame(this.loop),this.draw()});i(this,"draw",()=>{const{width:t,height:e}=this.canvasBoundingRect;this.context.drawImage(this.assetsManager.get("background/main-menu-bg"),0,0,t,e),this.buttons.forEach(s=>s.draw(this.context,this.canvasBoundingRect.height))});i(this,"handleMouseClick",()=>{this.opened&&(this.buttons[0].hover?(console.log("\u041D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443"),this.release()):this.buttons[1].hover&&console.log("\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435"))});i(this,"handleMouseMove",t=>{this.opened&&(this.lastMousePosition=new c(t.clientX-this.canvasBoundingRect.left,t.clientY-this.canvasBoundingRect.top),this.buttons.map(e=>e.hover=e.checkCursorColision(this.lastMousePosition,this.canvasBoundingRect.height)))});i(this,"initControlsListeners",()=>{this.controlsEvents=[{action:"keydown",event:new g(["Escape"],this.release)}],window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mousedown",this.handleMouseClick)});i(this,"startListeningControls",()=>this.controlsEvents.map(({action:t,event:e})=>this.controlsManager.addEventListener(t,e)));i(this,"stopListeningControls",()=>this.controlsEvents.map(({event:t})=>this.controlsManager.removeEventListener(t)));i(this,"loadAssets",async()=>await this.assetsManager.loadAssets([{path:"background/main-menu-bg",format:"png"},{path:"controls/button-start",format:"png"},{path:"controls/button-control",format:"png"}]));this.context=t,this.canvasBoundingRect=e,this.closeHandler=s,this.controlsManager=E.Instance,this.assetsManager=new T,this.init()}}class Wt{constructor(t,e,s){i(this,"context");i(this,"rAF",null);i(this,"grid",48);i(this,"level",[]);i(this,"colorMap",{R:"red",G:"green",B:"blue",Y:"yellow"});i(this,"assetsManager");i(this,"controlsManager");i(this,"controlsEvents",[]);i(this,"colorsKeys",Object.keys(this.colorMap));i(this,"colors",Object.values(this.colorMap));i(this,"bubbleGap",1);i(this,"wallSize",4);i(this,"bubbles",[]);i(this,"particles",[]);i(this,"curBubblePos");i(this,"curBubble");i(this,"shootDeg",0);i(this,"minDeg");i(this,"maxDeg");i(this,"shootDir",0);i(this,"endGameCallback");i(this,"canvasBoundingRect");i(this,"size");i(this,"init",async()=>{await this.loadAssets(),this.prepareLevel(),this.rAF=window.requestAnimationFrame(this.loop)});i(this,"degToRad",t=>t*Math.PI/180);i(this,"rotatePoint",(t,e,s)=>{const a=Math.sin(s),r=Math.cos(s);return{x:t*r-e*a,y:t*a+e*r}});i(this,"getRandomInt",(t,e)=>(t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t));i(this,"getDistance",(t,e)=>{const s=t.x-e.x,a=t.y-e.y;return Math.sqrt(s*s+a*a)});i(this,"collides",(t,e)=>this.getDistance(t,e)<t.radius+e.radius);i(this,"getClosestBubble",(t,e=!1)=>{const s=this.bubbles.filter(a=>a.active==e&&this.collides(t,a));if(!!s.length)return s.map(a=>({distance:this.getDistance(t,a),bubble:a})).sort((a,r)=>a.distance-r.distance)[0].bubble});i(this,"createBubble",(t,e,s)=>{const a=Math.floor(e/this.grid),r=Math.floor(t/this.grid),o=a%2===0?0:.5*this.grid,h=this.grid/2;this.bubbles.push({x:this.wallSize+(this.grid+this.bubbleGap)*r+o+h,y:this.wallSize+(this.grid+this.bubbleGap-4)*a+h,radius:this.grid/2,color:s,active:!!s})});i(this,"getNeighbors",t=>{const e=[],s=[this.rotatePoint(this.grid,0,0),this.rotatePoint(this.grid,0,this.degToRad(60)),this.rotatePoint(this.grid,0,this.degToRad(120)),this.rotatePoint(this.grid,0,this.degToRad(180)),this.rotatePoint(this.grid,0,this.degToRad(240)),this.rotatePoint(this.grid,0,this.degToRad(300))];for(let a=0;a<s.length;a++){const r=s[a],o={x:t.x+r.x,y:t.y+r.y,radius:t.radius},h=this.getClosestBubble(o,!0);h&&h!==t&&!e.includes(h)&&e.push(h)}return e});i(this,"removeMatch",t=>{const e=[t];this.bubbles.forEach(a=>a.processed=!1),t.processed=!0;let s=this.getNeighbors(t);for(let a=0;a<s.length;a++){const r=s[a];r.processed||(r.processed=!0,r.color===t.color&&(e.push(r),s=s.concat(this.getNeighbors(r))))}e.length>=3&&e.forEach(a=>{a.active=!1})});i(this,"dropFloatingBubbles",()=>{const t=this.bubbles.filter(s=>s.active);t.forEach(s=>s.processed=!1);let e=t.filter(s=>s.y-this.grid<=this.wallSize);for(let s=0;s<e.length;s++){const a=e[s];a.processed||(a.processed=!0,e=e.concat(this.getNeighbors(a)))}t.filter(s=>!s.processed).forEach(s=>{s.active=!1,this.particles.push({x:s.x,y:s.y,color:s.color,radius:s.radius,active:!0})})});i(this,"getNewBubble",()=>{this.curBubble.x=this.curBubblePos.x,this.curBubble.y=this.curBubblePos.y,this.curBubble.dx=this.curBubble.dy=0;const t=this.bubbles.filter(s=>s.active&&s.color).map(({color:s})=>s).reduce((s,a)=>!a||s.includes(a)?s:[...s,a],[]),e=this.getRandomInt(0,t.length-1);this.curBubble.color=t[e],t.length===0&&(this.endGameCallback(),this.rAF&&window.cancelAnimationFrame(this.rAF))});i(this,"handleCollision",t=>{t.color=this.curBubble.color,t.active=!0,this.removeMatch(t),this.dropFloatingBubbles(),this.getNewBubble()});i(this,"loop",()=>{this.rAF=requestAnimationFrame(this.loop),this.context.drawImage(this.assetsManager.get("background/bg-minigame"),0,0,this.canvasBoundingRect.width,this.canvasBoundingRect.height),this.update(),this.draw()});i(this,"update",()=>{if(this.shootDeg+=this.degToRad(2)*this.shootDir,this.shootDeg<this.minDeg?this.shootDeg=this.minDeg:this.shootDeg>this.maxDeg&&(this.shootDeg=this.maxDeg),this.curBubble.x+=this.curBubble.dx,this.curBubble.y+=this.curBubble.dy,this.curBubble.x-this.grid/2<this.wallSize?(this.curBubble.x=this.wallSize+this.grid/2,this.curBubble.dx*=-1):this.curBubble.x+this.grid/2>this.size.width-this.wallSize&&(this.curBubble.x=this.size.width-this.wallSize-this.grid/2,this.curBubble.dx*=-1),this.curBubble.y-this.grid/2<this.wallSize){const t=this.getClosestBubble(this.curBubble);t&&this.handleCollision(t)}for(let t=0;t<this.bubbles.length;t++){const e=this.bubbles[t];if(e.active&&this.collides(this.curBubble,e)){const s=this.getClosestBubble(this.curBubble);s||(window.alert("Game Over"),window.location.reload()),s&&this.handleCollision(s)}}this.particles.forEach(t=>{t.y+=8}),this.particles=this.particles.filter(t=>t.y<this.size.height-this.grid/2)});i(this,"draw",()=>{const t=this.canvasBoundingRect.width/2-this.size.width/2;this.context.fillStyle="lightgrey",this.context.fillRect(t,0,this.size.width,this.wallSize),this.context.fillRect(t,0,this.wallSize,this.size.height),this.context.fillRect(t+this.size.width-this.wallSize,0,this.wallSize,this.size.height),this.bubbles.concat(this.particles).forEach(e=>{!e.active||(this.context.fillStyle=e.color||"black",this.context.beginPath(),this.context.arc(t+e.x,e.y,e.radius,0,2*Math.PI),this.context.fill())}),this.context.save(),this.context.translate(t+this.curBubblePos.x,this.curBubblePos.y),this.context.rotate(this.shootDeg),this.context.translate(0,-this.grid/2*4.5),this.context.strokeStyle="black",this.context.lineWidth=2,this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(0,this.grid*2),this.context.moveTo(0,0),this.context.lineTo(-10,this.grid*.4),this.context.moveTo(0,0),this.context.lineTo(10,this.grid*.4),this.context.stroke(),this.context.restore(),this.context.fillStyle=this.curBubble.color,this.context.beginPath(),this.context.arc(t+this.curBubble.x,this.curBubble.y,this.curBubble.radius,0,2*Math.PI),this.context.fill()});i(this,"release",()=>{this.rAF&&window.cancelAnimationFrame(this.rAF),this.stopListeningControls(),this.endGameCallback()});i(this,"initControlsListeners",()=>{this.controlsEvents=[{action:"keydown",event:new g(["ArrowRight","KeyD"],this.handleMoveRight)},{action:"keydown",event:new g(["ArrowLeft","KeyA"],this.handleMoveLeft)},{action:"keydown",event:new g(["Space"],this.handleShoot)},{action:"keydown",event:new g(["Escape"],this.release)},{action:"keyup",event:new g(["KeyA","KeyD","ArrowLeft","ArrowRight"],this.handleMoveStop)}]});i(this,"startListeningControls",()=>this.controlsEvents.map(({action:t,event:e})=>this.controlsManager.addEventListener(t,e)));i(this,"stopListeningControls",()=>this.controlsEvents.map(({event:t})=>this.controlsManager.removeEventListener(t)));i(this,"handleShoot",()=>{this.curBubble.dx===0&&this.curBubble.dy===0&&(this.curBubble.dx=Math.sin(this.shootDeg)*this.curBubble.speed,this.curBubble.dy=-Math.cos(this.shootDeg)*this.curBubble.speed)});i(this,"handleMoveLeft",()=>this.shootDir=-1);i(this,"handleMoveRight",()=>this.shootDir=1);i(this,"handleMoveStop",()=>this.shootDir=0);i(this,"loadAssets",()=>this.assetsManager.loadAssets([{path:"background/bg-minigame",format:"jpg"}]));this.context=t,this.canvasBoundingRect=e,this.size={width:400,height:e.height},this.endGameCallback=s,this.assetsManager=new T,this.controlsManager=E.Instance,this.initControlsListeners(),this.startListeningControls(),this.minDeg=this.degToRad(-60),this.maxDeg=this.degToRad(60),this.curBubblePos={x:this.size.width/2,y:this.size.height-this.grid*1.5},this.curBubble={x:this.curBubblePos.x,y:this.curBubblePos.y,color:"red",radius:this.grid/2,speed:8,dx:0,dy:0},this.init()}prepareLevel(){var t;for(let e=0;e<5;e++){const s=e%2===0?8:7,a=[];for(let r=0;r<s;r++)a.push(this.colorsKeys[this.getRandomInt(0,this.colors.length-1)]);this.level.push(a)}for(let e=0;e<10;e++)for(let s=0;s<(e%2===0?8:7);s++){const a=(t=this.level[e])==null?void 0:t[s];this.createBubble(s*this.grid,e*this.grid,this.colorMap[a])}}}class gt{constructor(){i(this,"gameState");this.gameState={isGameOver:!1,isGameStarted:!1,isGamePaused:!1,currentLevel:0,worldState:{currentSantaSpawn:1,santaSpawnPositions:[new c(1e3,300),new c(2400,350),new c(3800,200),new c(5100,200)]},playerState:{playerRespawn:new c(250,250)}}}static get Instance(){return this._instance||(this._instance=new this)}get player(){return this.gameState.playerState.player}set player(t){this.gameState.playerState.player=t}get santa(){return this.gameState.worldState.santa}set santa(t){this.gameState.worldState.santa=t}}i(gt,"_instance");class Jt{constructor(t,e){i(this,"context");i(this,"canvasBoundingRect");i(this,"gameDriver");i(this,"mainMenu");i(this,"assetsManager");i(this,"soundManager");i(this,"controlsManager");i(this,"controlsEvents",[]);i(this,"gameStateManager");i(this,"gameStart",async()=>{this.pause(),await this.loadAssets(),await this.loadSounds(),this.gameDriver.backgroundImage=this.assetsManager.get("background/bg-game"),this.loadMap(),this.spawnPlayer(),this.spawnSanta(),this.initControlsListeners(),this.startListeningControls(),this.addSantaMeetingEventListener(),this.addGameOverEventListener()});i(this,"loadMap",()=>Promise.all([Promise.all(Ot.platforms.map(({id:t,type:e,position:s,behavior:a,size:r})=>e==="static"?this.spawnPlatform(t,s,r):this.spawnMovingPlatform(t,s,a,r))),this.spawnWater()]));i(this,"spawnPlayer",()=>{const t=new Gt(this.gameStateManager.gameState.playerState.playerRespawn.getCopy(),this.assetsManager.get("characters/player"));return this.gameStateManager.player=t,this.gameDriver.spawnObject(this.gameStateManager.player),t});i(this,"spawnSanta",()=>{const t=this.gameStateManager.gameState.worldState.santaSpawnPositions[0],e=new $t(new c(t.x,t.y),new c,this.assetsManager.get("characters/santa"));return this.gameStateManager.santa=e,this.gameDriver.spawnObject(this.gameStateManager.santa),e});i(this,"spawnWater",()=>{const t=new qt(new c(0,-400),{width:2*this.canvasBoundingRect.width,height:400},{head:this.assetsManager.get("water/head"),body:this.assetsManager.get("water/body")});return this.gameDriver.spawnObject(t),t});i(this,"spawnOverlay",async()=>{this.gameStateManager.gameState.overlay=this.gameDriver.overlay=new Ht(new c(0,0),this.canvasBoundingRect,this.assetsManager.get("dialog-overlay"))});i(this,"spawnPlatform",(t,e,s)=>{const a=new W(e?new c().setByCoordsObject(e):new c,s||{width:0,height:0},{head:this.assetsManager.get("platforms/base/head"),body:this.assetsManager.get("platforms/base/body")});return this.gameDriver.spawnObject(a),a});i(this,"spawnMovingPlatform",(t,e,s,a)=>{const r=new dt(e?new c().setByCoordsObject(e):new c,s?{...s,vTarget:new c().setByCoordsObject(s.target)}:{vTarget:new c,duration:1,repeat:"none"},a||{width:0,height:0},{head:this.assetsManager.get("platforms/base/head"),body:this.assetsManager.get("platforms/base/body")});return this.gameDriver.spawnObject(r),r});i(this,"addGameOverEventListener",()=>{this.gameStateManager.player&&this.gameStateManager.player.addEventListener(new Et("less","y",0,!1,()=>{this.gameStateManager.player&&(this.gameStateManager.player.vCoordinates=this.gameStateManager.gameState.playerState.playerRespawn.getCopy(),this.gameStateManager.player.vVelocity=new c)}))});i(this,"addSantaMeetingEventListener",()=>{this.gameStateManager.player&&this.gameStateManager.santa&&this.gameStateManager.player.addEventListener(new kt(this.gameStateManager.santa,!0,this.spawnOverlay))});i(this,"startMiniGame",()=>{if(this.gameStateManager.santa&&this.gameStateManager.gameState.playerState.player&&this.gameDriver.overlay)switch(delete this.gameStateManager.gameState.overlay,this.gameDriver.overlay=null,this.gameStateManager.gameState.playerState.playerRespawn=this.gameStateManager.santa.vCoordinates.getCopy(),this.gameStateManager.gameState.worldState.currentSantaSpawn<3&&(this.gameStateManager.santa.vCoordinates=this.gameStateManager.gameState.worldState.santaSpawnPositions[this.gameStateManager.gameState.worldState.currentSantaSpawn++].getCopy(),this.addSantaMeetingEventListener()),this.stopListeningControls(),this.gameDriver.pause(),this.gameStateManager.gameState.currentLevel++){case 0:new Wt(this.context,this.canvasBoundingRect,this.resume);break;case 1:new Nt(this.context,this.canvasBoundingRect,this.resume);break;case 2:{this.playMemo();break}case 3:console.log("YOU WIN");break}});i(this,"playMemo",()=>{});i(this,"pause",()=>{var t;this.gameStateManager.gameState.isGamePaused||((t=this.soundManager.get("holiday_game_theme"))==null||t.pause(),this.gameStateManager.gameState.isGamePaused=!0,this.stopListeningControls(),this.gameDriver.pause(),this.mainMenu.open())});i(this,"resume",()=>{this.gameStateManager.gameState.isGamePaused&&this.soundManager.get("holiday_game_theme").play(),this.gameStateManager.gameState.isGamePaused=!1,this.startListeningControls(),this.gameDriver.start()});i(this,"loadAssets",async()=>await this.assetsManager.loadAssets([{path:"background/bg-game",format:"jpg"},{path:"characters/player",format:"png"},{path:"characters/santa",format:"png"},{path:"water/head",format:"png"},{path:"water/body",format:"png"},{path:"dialog-overlay",format:"jpg"},{path:"platforms/base/head",format:"png"},{path:"platforms/base/body",format:"png"}]));i(this,"initControlsListeners",()=>{!this.gameStateManager.player||(this.controlsEvents=[{action:"keydown",event:new g(["ArrowUp","KeyW"],this.gameStateManager.player.startJumping)},{action:"keydown",event:new g(["ArrowRight","KeyD"],this.gameStateManager.player.startMoveRight)},{action:"keydown",event:new g(["ArrowLeft","KeyA"],this.gameStateManager.player.startMoveLeft)},{action:"keydown",event:new g(["Space"],this.startMiniGame)},{action:"keydown",event:new g(["Escape"],this.pause)},{action:"keyup",event:new g(["ArrowUp","KeyW"],this.gameStateManager.player.stopJumping)},{action:"keyup",event:new g(["ArrowRight","KeyD"],this.gameStateManager.player.stopMoveRight)},{action:"keyup",event:new g(["ArrowLeft","KeyA"],this.gameStateManager.player.stopMoveLeft)}])});i(this,"startListeningControls",()=>{this.controlsEvents.map(({action:t,event:e})=>this.controlsManager.addEventListener(t,e))});i(this,"stopListeningControls",()=>this.controlsEvents.map(({event:t})=>this.controlsManager.removeEventListener(t)));i(this,"loadSounds",async()=>await this.soundManager.loadSounds([{path:"holiday_game_theme",format:"mp3"}]));this.context=t,this.canvasBoundingRect=e,this.gameDriver=new Pt(t,e),this.gameStateManager=gt.Instance,this.controlsManager=E.Instance,this.assetsManager=new T,this.soundManager=new Kt,this.mainMenu=new Ut(this.context,this.canvasBoundingRect,this.resume),this.gameStart()}}function st(n,t,e){const s=n.slice();return s[12]=t[e].flip,s[13]=t[e].name,s[14]=t[e].alt,s[16]=e,s}function it(n){let t,e,s,a,r,o,h,l,u,L,A;function F(){return n[2](n[16])}return{c(){t=x("div"),e=x("img"),r=I(),o=x("img"),l=I(),this.h()},l(f){t=b(f,"DIV",{class:!0,"data-name":!0});var p=_(t);e=b(p,"IMG",{class:!0,src:!0,alt:!0}),r=P(p),o=b(p,"IMG",{class:!0,src:!0,alt:!0}),l=P(p),p.forEach(v),this.h()},h(){d(e,"class","front-face svelte-pdp5dg"),O(e.src,s="/new-year-game/assets/flip/"+n[13]+".svg")||d(e,"src",s),d(e,"alt",a=n[14]),d(o,"class","back-face svelte-pdp5dg"),O(o.src,h="/new-year-game/assets/flip/js-badge.svg")||d(o,"src",h),d(o,"alt","Memory Card"),d(t,"class","memory-card svelte-pdp5dg"),d(t,"data-name",u=n[13]),J(t,"flip",n[12])},m(f,p){S(f,t,p),y(t,e),y(t,r),y(t,o),y(t,l),L||(A=ft(t,"click",F),L=!0)},p(f,p){n=f,p&1&&!O(e.src,s="/new-year-game/assets/flip/"+n[13]+".svg")&&d(e,"src",s),p&1&&a!==(a=n[14])&&d(e,"alt",a),p&1&&u!==(u=n[13])&&d(t,"data-name",u),p&1&&J(t,"flip",n[12])},d(f){f&&v(t),L=!1,A()}}}function Yt(n){let t,e=n[0],s=[];for(let a=0;a<e.length;a+=1)s[a]=it(st(n,e,a));return{c(){t=x("div");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){t=b(a,"DIV",{class:!0});var r=_(t);for(let o=0;o<s.length;o+=1)s[o].l(r);r.forEach(v),this.h()},h(){d(t,"class","memory-game svelte-pdp5dg")},m(a,r){S(a,t,r);for(let o=0;o<s.length;o+=1)s[o].m(t,null)},p(a,[r]){if(r&3){e=a[0];let o;for(o=0;o<e.length;o+=1){const h=st(a,e,o);s[o]?s[o].p(h,r):(s[o]=it(h),s[o].c(),s[o].m(t,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=e.length}},i:V,o:V,d(a){a&&v(t),vt(s,a)}}}function Xt(n,t,e){const s=wt();let a=!1,r=!1,o=null,h=null,l=[{name:"react",alt:"React",flip:!1,order:0},{name:"react",alt:"React",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"angular",alt:"Angular",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"ember",alt:"Ember",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"vue",alt:"Vue",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"aurelia",alt:"Aurelia",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0},{name:"backbone",alt:"Backbone",flip:!1,order:0}];function u(w){if(!r&&o!==w){if(e(0,l[w].flip=!0,l),!a){a=!0,o=w;return}h=w,r=!0,L()}}function L(){o!==null&&h!==null&&(l[o].name===l[h].name?A():F(l[o],l[h]))}function A(){f(),l.some(w=>!w.flip)||s("done")}function F(w,M){setTimeout(()=>{w.flip=!1,M.flip=!1,e(0,l=[...l]),f()},1500)}function f(){a=!1,r=!1,o=null,h=null}return function(){e(0,l=l.map(M=>(M.order=Math.ceil(Math.random()*12),M)).sort((M,ut)=>M.order>ut.order?1:-1))}(),[l,u,w=>u(w)]}class at extends H{constructor(t){super(),K(this,t,Xt,Yt,N,{})}}function nt(n){let t,e,s;var a=at;function r(o){return{}}return a&&(t=X(a,r()),t.$on("done",n[3])),{c(){t&&G(t.$$.fragment),e=Z()},l(o){t&&ht(t.$$.fragment,o),e=Z()},m(o,h){t&&$(t,o,h),S(o,e,h),s=!0},p(o,h){if(a!==(a=at)){if(t){ot();const l=t;k(l.$$.fragment,1,0,()=>{q(l,1)}),rt()}a?(t=X(a,r()),t.$on("done",o[3]),G(t.$$.fragment),C(t.$$.fragment,1),$(t,e.parentNode,e)):t=null}},i(o){s||(t&&C(t.$$.fragment,o),s=!0)},o(o){t&&k(t.$$.fragment,o),s=!1},d(o){o&&v(e),t&&q(t,o)}}}function Zt(n){let t,e,s,a,r,o=n[0]&&n[2]&&nt(n);return{c(){t=x("div"),o&&o.c(),e=I(),s=x("canvas"),a=yt("Your browser does not support the HTML5 canvas tag."),this.h()},l(h){t=b(h,"DIV",{class:!0});var l=_(t);o&&o.l(l),e=P(l),s=b(l,"CANVAS",{width:!0,height:!0,class:!0});var u=_(s);a=xt(u,"Your browser does not support the HTML5 canvas tag."),u.forEach(v),l.forEach(v),this.h()},h(){d(s,"width",1320),d(s,"height",640),d(s,"class","svelte-1rfllgf"),Y(s,"display",n[2]?"none":"block"),d(t,"class","container")},m(h,l){S(h,t,l),o&&o.m(t,null),y(t,e),y(t,s),y(s,a),n[4](s),r=!0},p(h,[l]){h[0]&&h[2]?o?(o.p(h,l),l&5&&C(o,1)):(o=nt(h),o.c(),C(o,1),o.m(t,e)):o&&(ot(),k(o,1,1,()=>{o=null}),rt()),l&4&&Y(s,"display",h[2]?"none":"block")},i(h){r||(C(o),r=!0)},o(h){k(o),r=!1},d(h){h&&v(t),o&&o.d(),n[4](null)}}}function Qt(n,t,e){let s,a,r=!1;bt(async()=>{const l=a.getContext("2d");if(l){const u=a.getBoundingClientRect();e(0,s=new Jt(l,u)),e(0,s.playMemo=()=>e(2,r=!0),s)}});const o=()=>{e(2,r=!1),s.resume()};function h(l){Mt[l?"unshift":"push"](()=>{a=l,e(1,a)})}return[s,a,r,o,h]}class jt extends H{constructor(t){super(),K(this,t,Qt,Zt,N,{})}}function te(n){let t,e,s,a,r;return a=new jt({}),{c(){t=x("meta"),e=I(),s=x("section"),G(a.$$.fragment),this.h()},l(o){const h=Ct("svelte-t32ptj",document.head);t=b(h,"META",{name:!0,content:!0}),h.forEach(v),e=P(o),s=b(o,"SECTION",{class:!0});var l=_(s);ht(a.$$.fragment,l),l.forEach(v),this.h()},h(){document.title="Home",d(t,"name","description"),d(t,"content","Svelte demo app"),d(s,"class","svelte-iwe87e")},m(o,h){y(document.head,t),S(o,e,h),S(o,s,h),$(a,s,null),r=!0},p:V,i(o){r||(C(a.$$.fragment,o),r=!0)},o(o){k(a.$$.fragment,o),r=!1},d(o){v(t),o&&v(e),o&&v(s),q(a)}}}class ie extends H{constructor(t){super(),K(this,t,null,te,N,{})}}export{ie as default};
